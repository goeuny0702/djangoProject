{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>?´ë ¥???‘ì„±</title>
  <link rel="stylesheet" href="{% static 'main.css' %}">
</head>

<body>
  <div class="mycontainer">
    <div class="namecontainer">
      <h1>{{ user.username }}???˜ì˜?©ë‹ˆ????/h1>
    </div>
    <div class="logoutcontainer">
      <div class="logoutbtn"><a href="{% url 'logout' %}">ë¡œê·¸?„ì›ƒ</a></div>
    </div>
    <div class="writecontainer">
      <div class="writebtn"><a href="#" onclick="resetResumeForm(); return false;">?´ë ¥???±ë¡</a></div>
    </div>
    <div class="sidebar">
      <div class="resume-management">?´ë ¥??ê´€ë¦?/div>
      <div class="resume-list">
        {% for resume in resumes %}
          <div class="resume-item" style="position: relative; padding: 5px;" onmouseenter="this.querySelector('.delete-btn').style.display='inline'" onmouseleave="this.querySelector('.delete-btn').style.display='none'">
            <span onclick="loadResumeFromServer('{{ resume.id }}')" style="cursor: pointer;">
              {{ resume.title }}
            </span>
            <button class="delete-btn" onclick="deleteResume('{{ resume.id }}')" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); display: none; background: #f8d7da; border: none; color: #721c24; padding: 2px 6px; border-radius: 4px; cursor: pointer;">?? œ</button>
          </div>
        {% empty %}
          <p>?‘ì„±???´ë ¥?œê? ?†ìŠµ?ˆë‹¤.</p>
        {% endfor %}
    </div>
  </div>
  
    

  </div>
  <div class="main">
    <div style="display: flex; justify-content: center;">
      <input type="text" placeholder="?´ë ¥???œëª©" class="input-title" id="resume-title" name="title"><br>
    </div>
    <div class="inputgroup"
      style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
      {% comment %} ?¬ì§„ì²¨ë?ë¶€ {% endcomment %}
      <!-- ?¤ëª¨ ë°•ìŠ¤ -->
      <div id="profile-image-preview"
        style="width: 20%; height: 200px; background-color: #f8d7da; position: relative; background-size: cover; background-position: center; cursor: pointer;">
      {% if resume.profile_image %}
        <script>
          document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("profile-image-preview").style.backgroundImage = "url('{{ resume.profile_image.url }}')";
            document.getElementById("upload-plus").style.display = 'none';
          });
        </script>
      {% endif %}
      <span id="upload-plus" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px;">+</span>
    </div>
    <input type="file" id="profile-image-input" name="profile_image" style="display: none;" onchange="previewProfileImage(event)">




      
      <div class="personal-info" style="width: 70%;">
        <input type="text" placeholder="?´ë¦„" class="text_input_main" id="name">
        <input type="text" placeholder="?±ë³„" class="text_input_main" id="gender">
        <input type="text" placeholder="?ë…„?”ì¼" class="text_input_main" id="birthdate"><br><br>
        <input type="email" placeholder="?´ë©”?? class="text_input_main" id="email">
        <input type="text" placeholder="?´ë??? class="text_input_main" id="phone"><br><br>
        <input type="text" placeholder="ì£¼ì†Œ" class="text_input_main" id="address">
        <input type="text" placeholder="?ì„¸ì£¼ì†Œ" class="text_input_main" id="detail-address">
      </div>
    </div>


    <!--?™ë ¥-->
    <div class="section" id="education-section" style="display: none;">
      <div class="section-header"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
        <div class="section-title">?™ë ¥</div>
        <button class="addbtn" onclick="showEducationForm()">+ì¶”ê?</button>
      </div>
      <div id="education-list"></div>
    </div>
    <div id="education-form-template" style="display: none;">
      <div class="education-entry" style="margin: 5px;">
        <!-- ?€??ê²°ê³¼ë¥?ë³´ì—¬ì¤??ì—­ -->
        <div class="education-summary" style="display: none;"></div>
        <input type="text" placeholder="?™êµëª? class="text_input">
        <select class="text_input" id="education-select">
          <option>ì¡¸ì—…</option>
          <option>?¬í•™ì¤?/option>
          <option>?´í•™ì¤?/option>
        </select>
        <input type="date" placeholder="?…í•™?„ë„" class="text_input datepicker">
        <input type="date" placeholder="ì¡¸ì—…?„ë„" class="text_input datepicker"><br>
        <input type="text" placeholder="?„ê³µ" class="text_input">
        <input type="text" placeholder="?™ì " class="text_input">
        <div class="form-buttons">
          <button onclick="removeEducationForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveEducation(this)" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!--ê²½ë ¥-->
    <div class="section" id="career-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½ë ¥</div>
        <button class="addbtn" onclick="showCareerForm()">+ì¶”ê?</button>
      </div>
      <div id="career-list"></div>
    </div>
    <div id="career-form-template" style="display: none;">
      <div class="career-entry">
        <!-- ?€??ê²°ê³¼ ?œì‹œ -->
        <div class="career-summary" style="display: none;"></div>

        <input type="text" placeholder="?Œì‚¬ëª? class="text_input">
        <input type="date" placeholder="?…ì‚¬?„ì›”" class="text_input datepicker">
        <input type="date" placeholder="?´ì‚¬?„ì›”" class="text_input datepicker"><br>
        <input type="text" placeholder="ì§ë¬´" class="text_input">
        <input type="text" placeholder="ê·¼ë¬´ë¶€?? class="text_input">
        <input type="text" placeholder="ì§ê¸‰" class="text_input"><br>
        <textarea placeholder="?´ë‹¹?…ë¬´" class="longtext"></textarea>

        <div class="form-buttons">
          <button onclick="removeCareerForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveCareer(this)" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!-- ?¤í‚¬ -->
    <div class="section" id="skill-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">?¤í‚¬</div>
        <button class="addbtn" onclick="showskill()">+ì¶”ê?</button>
      </div>
      <div id="skill-list" style="margin: 10px 0;"></div>

      <div id="skill-form" style="display: none;">
        <div class="skill-search">
          <input type="text" id="skillSearch" placeholder="ê¸°ìˆ  ê²€??.." onkeyup="searchSkills()" autocomplete="off">
          <div id="skillSuggestions" class="suggestions" style="border: 1px solid #ccc; display: none;"></div>
        </div>
        <div class="form-buttons">
          <button onclick="cancelskill()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveskill()" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!-- ê²½í—˜/?œë™/êµìœ¡ -->
    <div class="section" id="experience-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½í—˜/?œë™/êµìœ¡</div>
        <button class="addbtn" onclick="showExperienceForm()">+ì¶”ê?</button>
      </div>
      <div id="experience-list"></div>
    </div>
    <!-- ê²½í—˜ ?œí”Œë¦?-->
    <div id="experience-form-template" style="display: none;">
      <div class="experience-entry">
        <div class="experience-summary" style="display: none;"></div>

        <select class="text_input">
          <option value="">?œë™ ? í˜• ? íƒ</option>
          <option value="campus">êµë‚´?œë™</option>
          <option value="volunteer">?ì›ë´‰ì‚¬</option>
          <option value="intern">?¸í„´</option>
          <option value="club">?™ì•„ë¦?/option>
          <option value="parttime">?„ë¥´ë°”ì´??/option>
          <option value="social">?¬íšŒ?œë™</option>
          <option value="project">?˜í–‰ê³¼ì œ</option>
          <option value="overseas">?´ì™¸?°ìˆ˜</option>
          <option value="education">êµìœ¡?´ìˆ˜?´ì—­</option>
        </select>
        <input type="text" placeholder="ê¸°ê?/?¥ì†Œëª? class="text_input"><br>
        <input type="date" placeholder="?œì‘?„ì›”" class="text_input datepicker">
        <input type="date" placeholder="ì¢…ë£Œ?„ì›”" class="text_input datepicker"><br>
        <textarea placeholder="?œë™ ?¤ëª…" class="longtext"></textarea>

        <div class="form-buttons">
          <button onclick="removeExperienceForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveExperience(this)" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!-- ================= ?ê²©/?´í•™/?˜ìƒ ================= -->
    <div class="section" id="certificate-section" style="display:none;">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:center;">
        <div class="section-title">?ê²©/?´í•™/?˜ìƒ</div>
        <button class="addbtn" onclick="showcertificate(false)">+ì¶”ê?</button>
      </div>

      <!-- ?€?¥ëœ ì¹´ë“œê°€ ?“ì´??ê³?-->
      <div id="certificate-list"></div>

      <!-- ?…ë ¥ ??-->
      <div id="certificate-form" style="display:none;">
        <select id="certificateType" class="text_input" onchange="showCertificateFields()">
          <option value="">êµ¬ë¶„ ? íƒ</option>
          <option value="license">?ê²©ì¦?/option>
          <option value="language">?´í•™</option>
          <option value="award">?˜ìƒ</option>
        </select>

        <!-- ?ê²©ì¦?-->
        <div id="licenseFields" class="cert-fields" style="display:none;">
          <input name="license_name" type="text" placeholder="?ê²©ì¦ëª…" class="text_input">
          <input name="issuer" type="text" placeholder="ë°œí–‰ì²? class="text_input">
          <input name="pass_date" type="month" class="text_input" placeholder="?©ê²©?„ì›”">
        </div>

        <!-- ?´í•™ -->
        <div id="languageFields" class="cert-fields" style="display:none;">
          <select name="lang" class="text_input">
            <option>?ì–´</option>
            <option>?¼ë³¸??/option>
            <option>ì¤‘êµ­??/option>
          </select>
          <input name="exam" type="text" placeholder="?´í•™?œí—˜ëª? class="text_input">
          <input name="score" type="text" placeholder="ê¸‰ìˆ˜/?ìˆ˜" class="text_input">
          <select name="status" class="text_input">
            <option>ì·¨ë“</option>
            <option>ë¯¸ì·¨??/option>
          </select>
        </div>

        <!-- ?˜ìƒ -->
        <div id="awardFields" class="cert-fields" style="display:none;">
          <input name="award_name" type="text" placeholder="?˜ìƒ/ê³µëª¨?„ëª…" class="text_input">
          <input name="award_date" type="date" class="text_input" placeholder="?˜ìƒ??>
          <input name="host" type="text" placeholder="?˜ì—¬/ì£¼ìµœê¸°ê?" class="text_input">
        </div>

        <div class="form-buttons">
          <button onclick="cancelcertificate()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savecertificate()" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!-- ================= ì·¨ì—…?°ë??¬í•­ ================= -->
    <div class="section" id="preference-section" style="display:none;">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:center;">
        <div class="section-title">ì·¨ì—…?°ë??¬í•­</div>
        <button class="addbtn" onclick="showPreference(false)">+ì¶”ê?</button>
      </div>

      <!-- ì¹´ë“œ ë¦¬ìŠ¤??-->
      <div id="preference-list"></div>

      <!-- ?…ë ¥ ??-->
      <div id="preference-form" style="display:none;">
        <select id="preferenceType" class="text_input" onchange="showPreferenceFields()">
          <option value="">êµ¬ë¶„ ? íƒ</option>
          <option value="veteran">ë³´í›ˆ?€??/option>
          <option value="military">ë³‘ì—­?€??/option>
          <option value="employment">ê³ ìš©ì§€?ê¸ˆ</option>
        </select>

        <!-- ë³´í›ˆ -->
        <div id="veteranFields" class="pref-fields" style="display:none;">
          <select name="v_type" class="text_input">
            <option>êµ??? ê³µ??/option><option>ë³´í›ˆ?€?ì</option>
          </select>
          <input name="v_cert" type="text" placeholder="ì¦ëª…??ë²ˆí˜¸" class="text_input">
        </div>

        <!-- ë³‘ì—­ -->
        <div id="militaryFields" class="pref-fields" style="display:none;">
          <select name="m_status" id="mStatus" class="text_input" onchange="toggleMilitaryDetail()">
            <option value="">ë³‘ì—­êµ¬ë¶„</option>
            <option value="served">êµ°í•„</option>
            <option value="exempt">ë©´ì œ</option>
            <option value="unserved">ë¯¸í•„</option>
          </select>

          <div id="servedDetail" style="display:none;">
            <input  name="m_start" type="month" class="text_input" placeholder="?…ë? YYYY-MM" min="1950-01" max="2100-12">
            <input  name="m_end"   type="month" class="text_input" placeholder="?„ì—­ YYYY-MM" min="1950-01" max="2100-12">
            <select name="m_branch" class="text_input">
              <option>?¡êµ°</option><option>?´êµ°</option><option>ê³µêµ°</option>
              <option>?´ë³‘</option><option>?˜ê²½</option><option>?¬íšŒë³µë¬´?”ì›</option>
            </select>
            <select name="m_rank" class="text_input">
              <option>?´ë³‘</option><option>?¼ë³‘</option><option>?ë³‘</option><option>ë³‘ì¥</option>
              <option>?˜ì‚¬</option><option>ì¤‘ì‚¬</option><option>?ì‚¬</option><option>?ì‚¬</option>
              <option>ì¤€??/option><option>?Œìœ„</option><option>ì¤‘ìœ„</option><option>?€??/option>
              <option>?Œë ¹</option><option>ì¤‘ë ¹</option><option>?€??/option>
              <option>ì¤€??/option><option>?Œì¥</option><option>ì¤‘ì¥</option><option>?€??/option>
            </select>
            <select name="m_reason" class="text_input">
              <option>ë§Œê¸°?„ì—­</option><option>?˜ê??¬ì „??/option><option>?˜ë³‘?„ì—­</option>
              <option>?Œì§‘?´ì œ</option><option>ë¶ˆëª…?ˆì „??/option><option>?ì´?„ì—­</option>
            </select>
          </div>
        </div>

        <!-- ê³ ìš©ì§€?ê¸ˆ -->
        <div id="employmentFields" class="pref-fields" style="display:none;">
          <select name="e_type" class="text_input">
            <option>ì²?…„ê³ ìš©ì§€?ê¸ˆ</option><option>?¥ì• ?¸ê³ ?©ì??ê¸ˆ</option>
          </select>
        </div>

        <div class="form-buttons">
          <button onclick="cancelPreference()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savePreference()"   class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!-- ?¬íŠ¸?´ë¦¬??-->
    <div class="section" id="portfolio-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">?¬íŠ¸?´ë¦¬??/div>
        <button class="addbtn" onclick="showPortfolioForm()">+ì¶”ê?</button>
      </div>
      <div id="portfolio-list"></div>
    </div>

    <!-- ?¬íŠ¸?´ë¦¬???œí”Œë¦?-->
    <div id="portfolio-form-template" style="display: none;">
      <div class="portfolio-entry">
        <div class="portfolio-summary" style="display: none;"></div>

        <input type="text" placeholder="?„ë¡œ?íŠ¸ëª? class="text_input"><br>
        <textarea placeholder="?„ë¡œ?íŠ¸ ?¤ëª…" class="longtext"></textarea>
        <input type="file" multiple class="text_input file-input">

        <div class="form-buttons">
          <button onclick="removePortfolioForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savePortfolio(this)" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>

    <!--ê²½ë ¥ê¸°ìˆ ??->
    <div class="section" id="description-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½ë ¥ê¸°ìˆ ??/div>
        <button class="addbtn" onclick="showdescription()">+ì¶”ê?</button>
      </div>

      <div id="career-description-list"></div>

      <!-- ?…ë ¥ ??-->
      <div id="career-description-form" style="display: none;">
        <textarea id="careerDescriptionText" class="longtext" placeholder="ê²½ë ¥ê¸°ìˆ ???´ìš©???…ë ¥?˜ì„¸??.."
          oninput="updateCharCount()" style="width: 100%; height: 200px; font-size: 16px;"></textarea>
          
        <div style="margin-top: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <button class="type-tab" onclick="insertTemplate('project')">?„ë¡œ?íŠ¸??/button>
            <button class="type-tab" onclick="insertTemplate('dev')">ê°œë°œ ê¸°ìˆ ??/button>
            <button class="type-tab" onclick="insertTemplate('design')">?”ì?´ë„ˆ??/button>
            <button class="type-tab" onclick="insertTemplate('sales')">?ì—… ?±ê³¼??/button>
          </div>
          <div style="color: #999; font-size: 14px;">
            ì´?ê¸€?ìˆ˜ <span id="totalChars">0</span>??/ <span id="totalBytes">0</span> byte
          </div>
        </div>

        <div style="margin-top: 10px; text-align: right;">
          <button onclick="canceldescription()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savedescription()" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>


    <!-- ?ê¸°?Œê°œ??-->
    <div class="section" id="introduction-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">?ê¸°?Œê°œ??/div>
      <button class="addbtn" onclick="showIntroductionForm()">+ì¶”ê?</button>
      </div>

      <!-- ?€?¥ëœ ?ê¸°?Œê°œ??ì¹´ë“œ ë¦¬ìŠ¤??-->
      <div id="introduction-list"></div>

      <!-- ?…ë ¥ ??-->
      <div id="introduction-form" style="display: none; margin-top: 15px;">
        <input type="text" id="introTitle" placeholder="?ê¸°?Œê°œ???œëª©" class="text_input" style="width: 100%; margin-bottom: 10px;">

        <textarea id="introTextarea" placeholder="?ê¸°?Œê°œ???´ìš©???…ë ¥?˜ì„¸?? oninput="updateIntroCount()" style="width: 100%; height: 200px; font-size: 16px;"></textarea>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
          <div class="intro-tools">
            <button type="button" onclick="checkSpelling()" class="cencle_save_btn tool-btn">
              ë§ì¶¤ë²?nbsp;ê²€??
            </button>
            <button type="button" onclick="runAIReview()" class="cencle_save_btn tool-btn">
              AI&nbsp;ì²¨ì‚­
            </button>
        </div>
          <div style="color: #999; font-size: 14px;">
            ì´?ê¸€?ìˆ˜ <span id="introChars">0</span>??/ <span id="introBytes">0</span> byte
        </div>
        </div>


        <div class="form-buttons">

          <button onclick="cancelIntroductionForm()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveIntroductionForm()" class="cencle_save_btn">?€??/button>
        </div>
      </div>
    </div>


    <!-- My Career ÆĞ³Î -->
    <div class="right-panel">
      <div class="right-panel-move">
        <div class="right-panel-title">
          <strong>My Career</strong>
        </div>
        <div class="checkbox-group">
          <div class="checkboxtext">
            <span>?™ë ¥</span>
            <input type="checkbox" id="section-education" onchange="toggleSection('education-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½ë ¥</span>
            <input type="checkbox" id="section-career" onchange="toggleSection('career-section')">
          </div>
          <div class="checkboxtext">
            <span>?¤í‚¬</span>
            <input type="checkbox" id="section-skill" onchange="toggleSection('skill-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½í—˜/?œë™/êµìœ¡</span>
            <input type="checkbox" id="section-experience" onchange="toggleSection('experience-section')">
          </div>
          <div class="checkboxtext">
            <span>?ê²©/?´í•™/?˜ìƒ</span>
            <input type="checkbox" id="section-certificate" onchange="toggleSection('certificate-section')">
          </div>
          <div class="checkboxtext">
            <span>ì·¨ì—…?°ë??¬í•­</span>
            <input type="checkbox" id="section-preference" onchange="toggleSection('preference-section')">
          </div>
          <div class="checkboxtext">
            <span>?¬íŠ¸?´ë¦¬??/span>
            <input type="checkbox" id="section-portfolio" onchange="toggleSection('portfolio-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½ë ¥ê¸°ìˆ ??/span>
            <input type="checkbox" id="section-description" onchange="toggleSection('description-section')">
          </div>
          <div class="checkboxtext">
            <span>?ê¸°?Œê°œ??/span>
            <input type="checkbox" id="section-introduction" onchange="toggleSection('introduction-section')">
          </div>
        </div>

        <button class="endbtn" onclick="previewResume()">?´ë ¥??ë¯¸ë¦¬ë³´ê¸°</button>

        <input type="hidden" id="sections-json">
        <button class="endbtn" onclick="saveResume(event)">?‘ì„±?„ë£Œ</button>

      </div>
    </div>


    <script>
      let selectedResumeId = null;

      const loggedInUserId = "{{ request.user.username }}";

       // ?¬ìš©???¤í‚¬ ëª©ë¡
      const availableSkills = [
      "Python", "Java", "C", "C++", "C#", "JavaScript", "TypeScript", "Go", "Kotlin", "Swift", "Ruby", "PHP", "Rust", "Scala",
      "HTML", "CSS", "React", "Vue.js", "Angular", "Next.js", "Svelte", "Tailwind CSS", "Bootstrap", "jQuery",
      "Django", "Flask", "Spring", "Spring Boot", "Node.js", "Express", "FastAPI", "NestJS", "Ruby on Rails", "ASP.NET",
      "MySQL", "PostgreSQL", "SQLite", "MongoDB", "Firebase", "Oracle", "AWS", "Azure", "Google Cloud", "Docker", "Kubernetes",
      "Git", "GitHub", "Linux", "VS Code", "Jenkins", "Notion", "Figma", "TensorFlow", "PyTorch", "OpenCV", "Unity", "Unreal Engine"
      ];


      // ? íƒ???¤í‚¬ ?€??ë°°ì—´
      let selectedSkills = [];

      function getSectionCheckboxStates() {
        return {
          education: document.getElementById('section-education').checked,
          career: document.getElementById('section-career').checked,
          skill: document.getElementById('section-skill').checked,
          experience: document.getElementById('section-experience').checked,
          certificate: document.getElementById('section-certificate').checked,
          preference: document.getElementById('section-preference').checked,
          portfolio: document.getElementById('section-portfolio').checked,
          description: document.getElementById('section-description').checked,
          introduction: document.getElementById('section-introduction').checked
        }
      }

      // ?ê¸°?Œê°œ???°ì´?°ë? ?˜ì§‘?˜ëŠ” ?¨ìˆ˜ (?´ì œ saveResume ?„ì— ?„ì¹˜)
      function collectIntroductionData() {
        // ... ?¨ìˆ˜ ?´ìš© ...
      }

      function saveResume() {
        const title = document.getElementById('resume-title').value;
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const birthdate = document.getElementById('birthdate').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const detailAddress = document.getElementById('detail-address').value;

        // sections ê°ì²´ ?•ì˜
        const sections = {
          education: collectEducationData() || [],
          career: collectCareerData() || [],
          experience: collectExperienceData() || [],
          certificate: collectCertificateData() || [],
          preference: collectPreferenceData() || [],
          portfolio: collectPortfolioData() || [],
          description: collectCareerDescriptionData() || [],
          introduction: collectIntroductionData() || [],
          skills: selectedSkills || [],
          sectionCheckboxStates: getSectionCheckboxStates()
        };

        const formData = new FormData();
        formData.append('title', title);
        formData.append('name', name);
        formData.append('gender', gender);
        formData.append('birthdate', birthdate);
        formData.append('email', email);
        formData.append('phone', phone);
        formData.append('address', address);
        formData.append('detail-address', detailAddress);
        formData.append('sections_json', JSON.stringify(sections));

        // ?„ë¡œ???´ë?ì§€ê°€ ?ˆìœ¼ë©?ì¶”ê?
        const profileImageFile = document.getElementById('profile-image-input').files[0];
        if (profileImageFile) {
          formData.append('profile_image', profileImageFile);
        }

        fetch('/save_resume/', {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: formData
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            alert("?€???¤íŒ¨");
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });


    }



      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }




      function addToResumeList(title) {
        const listDiv = document.querySelector('.resume-list');
        const newItem = document.createElement('div');
        newItem.textContent = title;
        newItem.onclick = () => loadResume(title);
        listDiv.appendChild(newItem);
      }

      function loadResume(title) {
        const resumes = JSON.parse(localStorage.getItem('resumeList')) || [];
        const resume = resumes.find(r => r.basicInfo.title === title);
        if (!resume) return;

        document.getElementById('resume-title').value = resume.basicInfo.title;
        document.getElementById('name').value = resume.basicInfo.name;
        document.getElementById('gender').value = resume.basicInfo.gender;
        document.getElementById('birthdate').value = resume.basicInfo.birthdate;
        document.getElementById('email').value = resume.basicInfo.email;
        document.getElementById('phone').value = resume.basicInfo.phone;
        document.getElementById('address').value = resume.basicInfo.address;
        document.getElementById('detail-address').value = resume.basicInfo.detailAddress;

      selectedSkills = resume.skills;

      // ë§Œì•½ ë°°ì—´???„ë‹ˆë©?ë¹?ë°°ì—´ë¡?ê°•ì œ
      if (!Array.isArray(selectedSkills)) {
        if (typeof selectedSkills === 'string') {
          try {
            selectedSkills = JSON.parse(selectedSkills);
            if (!Array.isArray(selectedSkills)) selectedSkills = [];
          } catch (e) {
            selectedSkills = [];
          }
        } else {
          selectedSkills = [];
        }
      }

        updateSkillList();

      }

    function loadResumeFromServer(resumeId) {
      selectedResumeId = resumeId;
      fetch(`/get_resume/${resumeId}/`)
        .then(response => {
          if (!response.ok) throw new Error('?´ë ¥??ë¶ˆëŸ¬?¤ê¸° ?¤íŒ¨');
          return response.json();
        })
        .then(data => {
          const resume = data.content;
          if (!resume) {
            alert("?´ë ¥???°ì´?°ê? ?†ìŠµ?ˆë‹¤.");
            return;
          }

          // ê¸°ë³¸ ?•ë³´
          document.getElementById('resume-title').value = data.title || '';
          document.getElementById('name').value = resume.name || '';
          document.getElementById('gender').value = resume.gender || '';
          document.getElementById('birthdate').value = resume.birthdate || '';
          document.getElementById('email').value = resume.email || '';
          document.getElementById('phone').value = resume.phone || '';
          document.getElementById('address').value = resume.address || '';
          document.getElementById('detail-address').value = resume.detail_address || '';

          // ê¸°ì¡´ ë¦¬ìŠ¤?¸ë“¤ ëª¨ë‘ ì´ˆê¸°??
          document.getElementById('education-list').innerHTML = '';
          document.getElementById('career-list').innerHTML = '';
          document.getElementById('experience-list').innerHTML = '';
          document.getElementById('skill-list').innerHTML = '';
          document.getElementById('certificate-list').innerHTML = '';
          document.getElementById('preference-list').innerHTML = '';
          document.getElementById('portfolio-list').innerHTML = '';
          document.getElementById('career-description-list').innerHTML = '';
          document.getElementById('introduction-list').innerHTML = '';

          // 1. ?™ë ¥
          if (resume.sections && Array.isArray(resume.sections.education)) {
            resume.sections.education.forEach(edu => {
              const list = document.getElementById('education-list');
              const entry = document.createElement('div');
              entry.className = 'education-entry';
              entry.innerHTML = `
                <div class="education-summary" style="display:block;">
                  <div class="education-card">
                    <h4>${edu.school || ''} (${edu.startDate || edu['?…í•™?„ë„'] || ''} ~ ${edu.endDate || edu['ì¡¸ì—…?„ë„'] || ''})</h4>
                    <p><strong>?„ê³µ:</strong> ${edu.major || edu['?„ê³µ'] || ''}</p>
                    <p><strong>?™ì :</strong> ${edu.grade || edu['?™ì '] || ''}</p>
                    <p><strong>ì¡¸ì—… êµ¬ë¶„:</strong> ${edu.graduation || edu['ì¡¸ì—…êµ¬ë¶„'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 2. ê²½ë ¥
          if (resume.sections && Array.isArray(resume.sections.career)) {
            resume.sections.career.forEach(career => {
              const list = document.getElementById('career-list');
              const entry = document.createElement('div');
              entry.className = 'career-entry';
              entry.innerHTML = `
                <div class="career-summary" style="display:block;">
                  <div class="career-card">
                    <h4>${career.company || ''} (${career.startDate || career['?…ì‚¬?„ì›”'] || ''} ~ ${career.endDate || career['?´ì‚¬?„ì›”'] || ''})</h4>
                    <p><strong>ì§ë¬´:</strong> ${career.position || career['ì§ë¬´'] || ''}</p>
                    <p><strong>ê·¼ë¬´ë¶€??</strong> ${career.department || career['ê·¼ë¬´ë¶€??] || ''}</p>
                    <p><strong>ì§ê¸‰:</strong> ${career.rank || career['ì§ê¸‰'] || ''}</p>
                    <p><strong>?´ë‹¹?…ë¬´:</strong> ${career.duties || career['?´ë‹¹?…ë¬´'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 3. ê²½í—˜/?œë™/êµìœ¡
          if (resume.sections && Array.isArray(resume.sections.experience)) {
            resume.sections.experience.forEach(exp => {
              const list = document.getElementById('experience-list');
              const entry = document.createElement('div');
              entry.className = 'experience-entry';
              entry.innerHTML = `
                <div class="experience-summary" style="display:block;">
                  <div class="experience-card">
                    <h4>${exp.activityType || exp['?œë™ ? í˜•'] || ''} - ${exp.place || exp['ê¸°ê?/?¥ì†Œëª?] || ''} 
                      (${exp.startDate || exp['?œì‘?„ì›”'] || ''} ~ ${exp.endDate || exp['ì¢…ë£Œ?„ì›”'] || ''})</h4>
                    <p><strong>?œë™ ?¤ëª…:</strong> ${exp.description || exp['?œë™ ?¤ëª…'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 4. ?¤í‚¬
          selectedSkills = (resume.sections && Array.isArray(resume.sections.skills)) ? resume.sections.skills : [];
          updateSkillList();

          // 5. ?ê²©/?´í•™/?˜ìƒ
          if (resume.sections && Array.isArray(resume.sections.certificate)) {
            const list = document.getElementById('certificate-list');
            resume.sections.certificate.forEach(cert => {
              const card = document.createElement('div');
              card.className = 'cert-card';

              let detail = '';
              if (cert.type === 'license' || cert.type === '?ê²©ì¦?) {
                detail = `<strong>[?ê²©ì¦?</strong> ${cert.license_name || cert['?ê²©ì¦ëª…'] || ''} Â· ${cert.issuer || cert['ë°œí–‰ì²?] || ''} (${cert.pass_date || cert['?©ê²©?„ì›”'] || ''})`;
              } else if (cert.type === 'language' || cert.type === '?´í•™') {
                detail = `<strong>[?´í•™]</strong> ${cert.lang || cert['?¸ì–´'] || ''} ${cert.exam || cert['?´í•™?œí—˜ëª?] || ''} ${cert.score || cert['ê¸‰ìˆ˜/?ìˆ˜'] || ''} (${cert.status || cert['ì·¨ë“?íƒœ'] || ''})`;
              } else if (cert.type === 'award' || cert.type === '?˜ìƒ') {
                detail = `<strong>[?˜ìƒ]</strong> ${cert.award_name || cert['?˜ìƒ/ê³µëª¨?„ëª…'] || ''} Â· ${cert.host || cert['?˜ì—¬/ì£¼ìµœê¸°ê?'] || ''} (${cert.award_date || cert['?˜ìƒ??] || ''})`;
              }
              card.innerHTML = `<span>${detail}</span>`;
              list.appendChild(card);
            });
          }

          // 6. ì·¨ì—…?°ë??¬í•­
          if (resume.sections && resume.sections.preference) {
            const list = document.getElementById('preference-list');
            const prefData = resume.sections.preference;

            // ê°ì²´??ê²½ìš° ë°°ì—´ë¡?ê°ì‹¸ê¸?
            const preferences = Array.isArray(prefData) ? prefData : [prefData];

            preferences.forEach(pref => {
              console.log("preference item:", pref); 
              const card = document.createElement('div');
              card.className = 'pref-card';
              let detail = '';

              if (pref.type === 'veteran' || pref.type === 'ë³´í›ˆ?€??) {
                detail = `[ë³´í›ˆ] ${pref.v_type || pref['ë³´í›ˆêµ¬ë¶„'] || ''} (ì¦ì„œ: ${pref.v_cert || pref['ì¦ëª…??ë²ˆí˜¸'] || ''})`;

              } else if (pref.type === 'military' || pref.type === 'ë³‘ì—­?€??) {
                const statusMap = {
                  'served': 'êµ°í•„',
                  'exempt': 'ë©´ì œ',
                  'unserved': 'ë¯¸í•„'
                };

                if (pref.m_status === 'served' || pref.m_status === 'êµ°í•„') {
                  detail = `[êµ°í•„] ${pref.m_branch || ''}Â·${pref.m_rank || ''} (${pref.m_start || ''}~${pref.m_end || ''}) / ${pref.m_reason || ''}`;
                } else {
                  detail = `[ë³‘ì—­] ${statusMap[pref.m_status] || pref.m_status || ''}`;
                }
              } else if (pref.type === 'military' || pref.type === 'ë³‘ì—­?€??) {
                detail = `[ë³‘ì—­] ${pref.m_status || ''}`;

              } else if (pref.type === 'employment' || pref.type === 'ê³ ìš©ì§€?ê¸ˆ') {
                detail = `[ì§€?ê¸ˆ] ${pref.e_type || ''}`;
              }

              if (detail) {
                card.innerHTML = `<span>${detail}</span>`;
                list.appendChild(card);
              }
            });
          }



          // 7. ?¬íŠ¸?´ë¦¬??
          if (resume.sections && Array.isArray(resume.sections.portfolio)) {
            const list = document.getElementById('portfolio-list');
            resume.sections.portfolio.forEach(port => {
              const entry = document.createElement('div');
              entry.className = 'portfolio-entry';
              let files = '';
              if (port.files && typeof port.files === 'string') files = port.files;
              if (Array.isArray(port.files)) files = port.files.join(', ');
              entry.innerHTML = `
                <div class="portfolio-summary" style="display:block;">
                  <div class="portfolio-card">
                    <h4>${port.project || port['?„ë¡œ?íŠ¸ëª?] || ''}</h4>
                    <p><strong>?¤ëª…:</strong> ${port.description || port['?„ë¡œ?íŠ¸ ?¤ëª…'] || ''}</p>
                    ${files ? `<p><strong>ì²¨ë??Œì¼:</strong> ${files}</p>` : ''}
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 8. ê²½ë ¥ê¸°ìˆ ??
          if (resume.sections && Array.isArray(resume.sections.description)) {
            const list = document.getElementById('career-description-list');
            resume.sections.description.forEach(desc => {
              const entry = document.createElement('div');
              entry.className = 'career-desc-card';
              entry.style.padding = "10px";
              entry.style.marginTop = "10px";
              entry.style.position = "relative";
              entry.innerHTML = `
                <div style="white-space: pre-wrap;">${desc.content || desc['?´ìš©'] || ''}</div>
              `;
              list.appendChild(entry);
            });
          }

          // 9. ?ê¸°?Œê°œ??(?¬ëŸ¬ê°??€?¥í•  ???ˆê²Œ)
          if (resume.sections && Array.isArray(resume.sections.introduction)) {
            const list = document.getElementById('introduction-list');
            resume.sections.introduction.forEach(intro => {
              const entry = document.createElement('div');
              entry.className = 'introduction-card';
              entry.style.borderBottom = "1px solid #ddd";
              entry.style.padding = "10px";
              entry.style.marginTop = "10px";
              entry.style.position = "relative";
              entry.innerHTML = `
                <h4>${intro.title || intro['?œëª©'] || ''}</h4>
                <div style="white-space: pre-wrap;">${intro.content || intro['?´ìš©'] || ''}</div>
              `;
              list.appendChild(entry);
            });
          }

          // 10. ì²´í¬ë°•ìŠ¤ ?íƒœ ë³µì› ë°??¹ì…˜ ?´ê¸°
          if (resume.sections && resume.sections.sectionCheckboxStates) {
            const cb = resume.sections.sectionCheckboxStates;
            Object.keys(cb).forEach(key => {
              const checked = !!cb[key];
              const checkbox = document.getElementById(`section-${key}`);
              const section = document.getElementById(`${key}-section`);

              console.log(`checkbox id: section-${key}`, checkbox, "checked:", checked);
              
              if (checkbox) checkbox.checked = checked;
              if (section) section.style.display = checked ? 'block' : 'none';
            });
          }

          //?´ë?ì§€ì§€
          if (data.profile_image_url) {
            const previewDiv = document.getElementById("profile-image-preview");
            previewDiv.style.backgroundImage = `url('${data.profile_image_url}')`;
            document.getElementById("upload-plus").style.display = 'none';
          }

        })
        .catch(error => {
          alert('?´ë ¥??ë¶ˆëŸ¬?¤ê¸° ?¤íŒ¨: ' + error.message);
        });


    }







    function deleteResume(resumeId) {
      if (!confirm("?•ë§ ???´ë ¥?œë? ?? œ?˜ì‹œê² ìŠµ?ˆê¹Œ?")) return;

      fetch(`/resume/delete/${resumeId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert("?´ë ¥?œê? ?? œ?˜ì—ˆ?µë‹ˆ??");
          location.reload();
        } else {
          alert("?? œ ?¤íŒ¨");
        }
      })
      .catch(error => {
        console.error("?? œ ?¤ë¥˜:", error);
        alert("?¤ë¥˜ ë°œìƒ");
      });
    }






      // ê°??¹ì…˜ë³??°ì´???˜ì§‘ ?¨ìˆ˜??
      function collectEducationData() {
        const summaries = document.querySelectorAll('.education-summary');

        return Array.from(summaries).map(summary => {
          const card = summary.querySelector('.education-card');
          if (!card) return null;

          const schoolText = card.querySelector('h4')?.textContent || '';
          const majorText = card.querySelector('p:nth-child(2)')?.textContent.replace('?„ê³µ:', '').trim() || '';
          const gradeText = card.querySelector('p:nth-child(3)')?.textContent.replace('?™ì :', '').trim() || '';
          const graduationText = card.querySelector('p:nth-child(4)')?.textContent.split('?? œ')[0].replace('ì¡¸ì—… êµ¬ë¶„:', '').trim() || '';

          return {
            school: schoolText,
            major: majorText,
            grade: gradeText,
            graduation: graduationText
          };
        }).filter(item => item !== null);
      }

      //ê²½ë ¥
      function collectCareerData() {
        const careerEntries = document.querySelectorAll('.career-card');
        return Array.from(careerEntries).map(entry => {
          const companyText = entry.querySelector('h4').textContent;
          const positionText = entry.querySelector('p:nth-child(2)').textContent.replace('ì§ë¬´:', '').trim();
          const departmentText = entry.querySelector('p:nth-child(3)').textContent.replace('ê·¼ë¬´ë¶€??', '').trim();
          const rankText = entry.querySelector('p:nth-child(4)').textContent.replace('ì§ê¸‰:', '').trim();
          const dutiesText = entry.querySelector('p:nth-child(5)').textContent.replace('?´ë‹¹?…ë¬´:', '').trim();

          // ?Œì‚¬ëª…ê³¼ ê¸°ê°„ ë¶„ë¦¬
          const [company, period] = companyText.split(' (');
          const [startDate, endDate] = period.replace(')', '').split(' ~ ');

          return {
            company: company.trim(),
            startDate: startDate.trim(),
            endDate: endDate.trim(),
            position: positionText,
            department: departmentText,
            rank: rankText,
            duties: dutiesText
          };
        });
      }
      //ê²½í—˜/?œë™/êµìœ¡
      function collectExperienceData() {
        const experienceEntries = document.querySelectorAll('.experience-card');
        return Array.from(experienceEntries).map(entry => {
          const activityText = entry.querySelector('h4').textContent;
          const descriptionText = entry.querySelector('p:nth-child(2)').textContent.replace('?œë™ ?¤ëª…:', '').trim();

          // ?œë™ ? í˜•, ê¸°ê?/?¥ì†Œëª? ê¸°ê°„ ë¶„ë¦¬
          const [activityType, placeAndPeriod] = activityText.split(' - ');
          const [place, period] = placeAndPeriod.split(' (');
          const [startDate, endDate] = period.replace(')', '').split(' ~ ');

          return {
            activityType: activityType.trim(),
            place: place.trim(),
            startDate: startDate.trim(),
            endDate: endDate.trim(),
            description: descriptionText
          };
        });
      }
      //?ê²©/?´í•™/?˜ìƒ
      function collectCertificateData() {
        const certificateEntries = document.querySelectorAll('.cert-card');
        return Array.from(certificateEntries).map(entry => {
          const detailText = entry.querySelector('span').textContent;
          
          // ?ê²©ì¦? ?´í•™, ?˜ìƒ êµ¬ë¶„
          if (detailText.includes('[?ê²©ì¦?')) {
            const [_, info] = detailText.split('[?ê²©ì¦?');
            const [name, issuerAndDate] = info.split('Â·');
            const [issuer, date] = issuerAndDate.split('(');
            
            return {
              type: 'license',
              license_name: name.trim(),
              issuer: issuer.trim(),
              pass_date: date.replace(')', '').trim()
            };
          } else if (detailText.includes('[?´í•™]')) {
            const [_, info] = detailText.split('[?´í•™]');
            const [lang, exam, score, status] = info.split(' ');
            
            return {
              type: 'language',
              lang: lang.trim(),
              exam: exam.trim(),
              score: score.trim(),
              status: status.replace('(', '').replace(')', '').trim()
            };
          } else {
            const [_, info] = detailText.split('[?˜ìƒ]');
            const [name, hostAndDate] = info.split('Â·');
            const [host, date] = hostAndDate.split('(');
            
            return {
              type: 'award',
              award_name: name.trim(),
              host: host.trim(),
              award_date: date.replace(')', '').trim()
            };
          }
        });
      }
      //ì·¨ì—…?°ë??¬í•­
      function collectPreferenceData() {
        return preferenceData;  // ???„ì—­ ë°°ì—´ preferenceDataë¥?ê·¸ë?ë¡?ë°˜í™˜
      }

      //?¬íŠ¸?´ë¦¬??
      function collectPortfolioData() {
        const portfolioEntries = document.querySelectorAll('.portfolio-card');
        return Array.from(portfolioEntries).map(entry => {
          const projectName = entry.querySelector('h4').textContent;
          const description = entry.querySelector('p:nth-child(2)').textContent.replace('?¤ëª…:', '').trim();
          const filesText = entry.querySelector('p:nth-child(3)')?.textContent;
          const files = filesText ? filesText.replace('ì²¨ë??Œì¼:', '').trim() : '';
          
          // localStorage???€??
          const portfolioData = {
            project: projectName,
            description: description,
            files: files
          };
          
          // ê¸°ì¡´ ?°ì´??ê°€?¸ì˜¤ê¸?
          let savedPortfolios = JSON.parse(localStorage.getItem('portfolios') || '[]');
          savedPortfolios.push(portfolioData);
          localStorage.setItem('portfolios', JSON.stringify(savedPortfolios));
          
          return portfolioData;
        });
      }
      //ê²½ë ¥ê¸°ìˆ ??
      function collectCareerDescriptionData() {
        const descriptionCards = document.querySelectorAll('.career-desc-card');
        const descriptions = Array.from(descriptionCards).map(card => {
          const content = card.querySelector('div').innerText;
          
          // localStorage???€??
          const descriptionData = {
            content: content
          };
          
          // ê¸°ì¡´ ?°ì´??ê°€?¸ì˜¤ê¸?
          let savedDescriptions = JSON.parse(localStorage.getItem('careerDescriptions') || '[]');
          savedDescriptions.push(descriptionData);
          localStorage.setItem('careerDescriptions', JSON.stringify(savedDescriptions));
          
          return descriptionData;
        });
        
        return descriptions;
      }


      // ì¶”ê? ë²„íŠ¼ ?„ë¥´ë©?ê²€?‰ì°½ ë³´ì´ê¸?
      function showskill() {
        document.getElementById("skill-form").style.display = "block";
        document.getElementById("skillSearch").value = "";
        document.getElementById("skillSuggestions").innerHTML = "";
        document.getElementById("skillSuggestions").style.display = "none";
      }

      // ì·¨ì†Œ ë²„íŠ¼ ?„ë¥´ë©?ê²€?‰ì°½ ?¨ê¸°ê¸?
      function cancelskill() {
        document.getElementById("skill-form").style.display = "none";
        document.getElementById("skillSearch").value = "";
        document.getElementById("skillSuggestions").innerHTML = "";
        document.getElementById("skillSuggestions").style.display = "none";
      }

      // ?€??ë²„íŠ¼ ?„ë¥´ë©?? íƒ???¤í‚¬ ?”ë©´??ì¶œë ¥
      function saveskill() {
      updateSkillList();
      document.getElementById("skill-form").style.display = "none";
      }


      // ?ë™?„ì„± ê²€??
      function searchSkills() {
      const input = document.getElementById("skillSearch").value.toLowerCase();
      const suggestionsBox = document.getElementById("skillSuggestions");
      suggestionsBox.innerHTML = "";

      if (!input) {
        suggestionsBox.style.display = "none";
        return;
      }

      const matches = availableSkills.filter(skill =>
        skill.toLowerCase().includes(input) && !selectedSkills.includes(skill)
      );

      if (matches.length === 0) {
        suggestionsBox.style.display = "none";
        return;
      }

      suggestionsBox.style.display = "block";
      matches.forEach(skill => {
        const div = document.createElement("div");
        div.textContent = skill;
        div.style.padding = "5px";
        div.style.cursor = "pointer";
        div.style.borderBottom = "1px solid #eee";

        div.onclick = () => {
          selectedSkills.push(skill);
          document.getElementById("skillSearch").value = "";
          suggestionsBox.style.display = "none";

          // ??ë¦¬ìŠ¤???¤ì‹œê°??…ë°?´íŠ¸
          const list = document.getElementById("skill-list");
          updateSkillList();
          searchSkills(); // ì¤‘ë³µ ?œê±°??

        };

        suggestionsBox.appendChild(div);
      });
    }

    function updateSkillList() {
      const list = document.getElementById("skill-list");
      list.innerHTML = "";

      if (!Array.isArray(selectedSkills)) {
        try {
          selectedSkills = JSON.parse(selectedSkills);
          if (!Array.isArray(selectedSkills)) selectedSkills = [];
        } catch (e) {
          selectedSkills = [];
        }
      }

      selectedSkills.forEach((skill, index) => {
        const span = document.createElement("span");
        span.className = "skill-tag";
        span.style.position = "relative";
        span.style.display = "inline-block";
        span.style.marginRight = "10px";
        span.style.padding = "6px 24px 6px 10px";
        span.style.border = "3px solid #F5D1EA";
        span.style.borderRadius = "5px";
        span.style.backgroundColor = "none";
        span.style.cursor = "default";

        const skillText = document.createTextNode(`??${skill}`);
        span.appendChild(skillText);

        const closeBtn = document.createElement("span");  // ??? ì–¸ ë¨¼ì?!
        closeBtn.className = "delete-btn";
        closeBtn.textContent = "Ã—";
        closeBtn.style.position = "absolute";
        closeBtn.style.right = "4px";
        closeBtn.style.top = "4px";
        closeBtn.style.fontSize = "14px";
        closeBtn.style.cursor = "pointer";
        closeBtn.style.color = "#ff4d4d";
        closeBtn.style.backgroundColor = "#fff";
        closeBtn.style.padding = "0 4px";
        closeBtn.style.borderRadius = "50%";
        closeBtn.style.border = "1px solid #ccc";
        closeBtn.style.display = "none"; // ??? ì–¸ ?´í›„??display ì¡°ì‘

        // ë§ˆìš°???¤ë²„ ??ë³´ì´ê¸?
        span.addEventListener("mouseenter", () => {
          closeBtn.style.display = "inline";
        });
        span.addEventListener("mouseleave", () => {
          closeBtn.style.display = "none";
        });

        closeBtn.onclick = () => {
          selectedSkills.splice(index, 1);
          updateSkillList();
        };

        span.appendChild(closeBtn);
        list.appendChild(span);
      });
    }







      //? ê? 
      function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        section.style.display = section.style.display === 'none' ? 'block' : 'none';
      }

      
      //?™ë ¥ ì¶”ê?
      function showEducationForm() {

        const list = document.getElementById('education-list');

        // ?…ë ¥?€??ë³´ì´???íƒœ = ?„ì§ ?€?¥ë˜ì§€ ?Šì? ?¼ì´ ?´ë ¤?ˆë‹¤????
        const isFormOpen = Array.from(list.querySelectorAll('.education-entry')).some(entry => {
          const inputs = entry.querySelectorAll('input, textarea');
          return Array.from(inputs).some(input => input.style.display !== 'none');
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById("education-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = 'block';
        list.appendChild(clone);
      }
      //?™ë ¥ ?? œ
      function removeEducationForm(button) {
        const entry = button.closest(".education-entry");
        if (entry) {
          entry.remove();
        }
      }
      // ?™ë ¥ ?˜ì •?˜ê¸°
      function editEducation(button) {
        const entry = button.closest(".education-entry");
        const summary = entry.querySelector(".education-summary");
        const inputs = entry.querySelectorAll("input, select");
        const formButtons = entry.querySelector(".form-buttons");

        // ?”ì•½ ì¹´ë“œ ?¨ê¸°ê¸?
        summary.style.display = "none";

        // ?…ë ¥ ?„ë“œ ?¤ì‹œ ë³´ì´ê²?
        inputs.forEach(input => input.style.display = "inline-block");

        // ê¸°ì¡´ card-buttons ?œê±°
        const cardButtons = summary.querySelector(".card-buttons");
        if (cardButtons) {
          cardButtons.remove();
        }

        // ?€???? œ ë²„íŠ¼ ?¤ì‹œ ?ì„±
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }
      //?™ë ¥ ?€??
      function saveEducation(button) {
        const entry = button.closest(".education-entry");
        const summary = entry.querySelector(".education-summary");
        const inputs = entry.querySelectorAll("input, select");
        const formButtons = entry.querySelector(".form-buttons");

        let values = {};

        inputs.forEach(input => {
          if (input.tagName.toLowerCase() === "select") {
            values["ì¡¸ì—…êµ¬ë¶„"] = input.options[input.selectedIndex].text;
          } else {
            const key = input.placeholder || '? íƒ';
            values[key] = input.value.trim();
          }
        });

        // ? ì§œ ?•ì‹ ê²€ì¦?
        const startDate = new Date(values['?…í•™?„ë„']);
        const endDate = new Date(values['ì¡¸ì—…?„ë„']);

        if (startDate > endDate) {
          alert('ì¡¸ì—…?„ë„???…í•™?„ë„ë³´ë‹¤ ?´í›„?¬ì•¼ ?©ë‹ˆ??');
          return;
        }

        // ?„ìˆ˜ ?…ë ¥ê°?ê²€ì¦?
        if (!values['?™êµëª?] || !values['?…í•™?„ë„'] || !values['ì¡¸ì—…?„ë„'] || !values['?„ê³µ'] || !values['?™ì ']) {
          alert('?™êµëª? ?…í•™?„ë„, ì¡¸ì—…?„ë„???„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??');
          return;
        }

        function searchSkills() {
          const input = document.getElementById("skillSearch").value.toLowerCase();
          const suggestionsBox = document.getElementById("skillSuggestions");
          suggestionsBox.innerHTML = "";

          if (!input) {
            suggestionsBox.style.display = "none";
            return;
          }

          const matches = availableSkills.filter(skill =>
            skill.toLowerCase().includes(input) && !selectedSkills.includes(skill)
          );

          if (matches.length === 0) {
            suggestionsBox.style.display = "none";
            return;
          }

          suggestionsBox.style.display = "block";
          matches.forEach(skill => {
            const div = document.createElement("div");
            div.textContent = skill;
            div.style.padding = "5px";
            div.style.cursor = "pointer";
            div.onclick = () => {
              selectedSkills.push(skill);
              document.getElementById("skillSearch").value = "";
              suggestionsBox.style.display = "none";
              searchSkills(); // ?¤ì‹œ ?¤í–‰?´ì„œ ??ëª©ë¡ ë°˜ì˜
            };
            suggestionsBox.appendChild(div);
          });
        }


        // ë³´ê¸° ì¹´ë“œ ?•íƒœë¡?ì¶œë ¥??HTML êµ¬ì„±
        summary.innerHTML = `
    <div class="education-card">
      <h4>${values['?™êµëª?] || ''} (${values['?…í•™?„ë„'] || ''} ~ ${values['ì¡¸ì—…?„ë„'] || ''})</h4>
      <p><strong>?„ê³µ:</strong> ${values['?„ê³µ'] || ''}</p>
      <p><strong>?™ì :</strong> ${values['?™ì '] || ''}</p>
      <p><strong>ì¡¸ì—… êµ¬ë¶„:</strong> ${values['ì¡¸ì—…êµ¬ë¶„'] || ''}
              <button onclick="editEducation(this)" class="cencle_save_btn" style="float: right; margin-left: 8px;">?˜ì •</button>
              <button onclick="removeEducationForm(this)" class="cencle_save_btn" style="float: right;">?? œ</button>
      </p>
    </div>
  `;


        // ?…ë ¥ ?”ì†Œ ?¨ê¸°ê¸?
        inputs.forEach(input => input.style.display = "none");

        // ë²„íŠ¼ ?¨ê¸°ê¸?
        if (formButtons) {
          formButtons.style.display = "none";
        }

        // ?”ì•½ ì¹´ë“œ ë³´ì´ê¸?
        summary.style.display = "block";
      }

      //ê²½ë ¥
      function showCareerForm() {

        const list = document.getElementById("career-list");

        // ?„ì¬ ?´ë ¤ ?ˆëŠ” ?¼ì´ ?ˆëŠ”ì§€ ?•ì¸ (input/textareaê°€ ë³´ì´???íƒœ)
        const isFormOpen = Array.from(list.querySelectorAll(".career-entry")).some(entry => {
          const inputs = entry.querySelectorAll("input, textarea");
          return Array.from(inputs).some(input => input.style.display !== "none");
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById("career-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = "block";
        list.appendChild(clone);
      }
      //ê²½ë ¥ ?? œ
      function removeCareerForm(button) {
        const entry = button.closest(".career-entry");
        if (entry) {
          entry.remove();
        }
      }
      //ê²½ë ¥ ?€??
      function saveCareer(button) {
        const entry = button.closest(".career-entry");
        const summary = entry.querySelector(".career-summary");

        // inputê³?textarea ëª¨ë‘ ? íƒ
        const inputs = entry.querySelectorAll("input, textarea");
        const values = {};

        // ?…ë ¥ê°??˜ì§‘
        inputs.forEach(input => {
          values[input.placeholder] = input.value;
        });

        // ?„ìˆ˜ ?…ë ¥ê°?ê²€ì¦?
        if (!values['?Œì‚¬ëª?] || !values['?…ì‚¬?„ì›”'] || !values['?´ì‚¬?„ì›”'] || !values['ê·¼ë¬´ë¶€??] || !values['ì§ë¬´'] || !values['?´ë‹¹?…ë¬´']) {
          alert('?Œì‚¬ëª? ?…ì‚¬?„ì›”, ?´ì‚¬?„ì›”, ê·¼ë¬´ë¶€?? ì§ë¬´, ?´ë‹¹?…ë¬´???„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??');
          return;
        }

        // ? ì§œ ?•ì‹ ê²€ì¦?
        const startDate = new Date(values['?…ì‚¬?„ì›”']);
        const endDate = new Date(values['?´ì‚¬?„ì›”']);

        if (startDate > endDate) {
          alert('?´ì‚¬?„ì›”???…ì‚¬?„ì›”ë³´ë‹¤ ?´í›„?¬ì•¼ ?©ë‹ˆ??');
          return;
        }

        // HTML ?œí”Œë¦??ì„±
        const careerCard = document.createElement('div');
        careerCard.className = 'career-card';
        careerCard.innerHTML = `
          <h4>${values['?Œì‚¬ëª?] || ''} (${values['?…ì‚¬?„ì›”'] || ''} ~ ${values['?´ì‚¬?„ì›”'] || ''})</h4>
          <p><strong>ì§ë¬´:</strong> ${values['ì§ë¬´'] || ''}</p>
          <p><strong>ê·¼ë¬´ë¶€??</strong> ${values['ê·¼ë¬´ë¶€??] || ''}</p>
          <p><strong>ì§ê¸‰:</strong> ${values['ì§ê¸‰'] || ''}</p>
          <p><strong>?´ë‹¹?…ë¬´:</strong> ${values['?´ë‹¹?…ë¬´'] || ''}</p>
          <div class="card-buttons" style="display: flex; justify-content: flex-end; gap: 8px;">
            <button onclick="editCareer(this)" class="cencle_save_btn">?˜ì •</button>
            <button onclick="removeCareerForm(this)" class="cencle_save_btn">?? œ</button>
          </div>
        `;

        // ê¸°ì¡´ ?´ìš© ì§€?°ê³  ?ˆë¡œ??ì¹´ë“œ ì¶”ê?
        summary.innerHTML = '';
        summary.appendChild(careerCard);

        // ?…ë ¥ ?”ì†Œ ?¨ê¸°ê¸?
        inputs.forEach(input => input.style.display = "none");

        // ?€??ì·¨ì†Œ ë²„íŠ¼ ?¨ê¸°ê¸?
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        // ?”ì•½ ì¹´ë“œ ?œì‹œ
        summary.style.display = "block";

        // localStorage???€??
        const careerData = {
          company: values['?Œì‚¬ëª?],
          startDate: values['?…ì‚¬?„ì›”'],
          endDate: values['?´ì‚¬?„ì›”'],
          position: values['ì§ë¬´'],
          department: values['ê·¼ë¬´ë¶€??],
          rank: values['ì§ê¸‰'],
          duties: values['?´ë‹¹?…ë¬´']
        };

        // ê¸°ì¡´ ?°ì´??ê°€?¸ì˜¤ê¸?
        let savedCareers = JSON.parse(localStorage.getItem('careers') || '[]');
        savedCareers.push(careerData);
        localStorage.setItem('careers', JSON.stringify(savedCareers));
      }
      //ê²½ë ¥ ?˜ì •
      function editCareer(button) {
        const entry = button.closest(".career-entry");
        const summary = entry.querySelector(".career-summary");

        // inputê³?textarea ëª¨ë‘ ? íƒ
        const inputs = entry.querySelectorAll("input, textarea");

        // ?”ì•½ ì¹´ë“œ ?¨ê?
        summary.style.display = "none";

        // ëª¨ë“  ?…ë ¥ ?„ë“œ ?¤ì‹œ ë³´ì´ê¸?
        inputs.forEach(input => input.style.display = "inline-block");

        // ?”ì•½ ì¹´ë“œ ??ë²„íŠ¼ ê·¸ë£¹ ?œê±°
        const cardButtons = summary.querySelector(".card-buttons");
        if (cardButtons) cardButtons.remove();

        // ?€??ì·¨ì†Œ ë²„íŠ¼ ?¤ì‹œ ë³´ì´ê²?+ ?•ë ¬ ?¤í????ìš©
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }

      //ê²½í—˜/?œë™/êµìœ¡
      function showExperienceForm() {

        const list = document.getElementById("experience-list");

        // ?„ì¬ ?…ë ¥ ì¤‘ì¸ ?¼ì´ ?ˆëŠ”ì§€ ?•ì¸ //
        const isFormOpen = Array.from(list.querySelectorAll(".experience-entry")).some(entry => {
          const inputs = entry.querySelectorAll("input, textarea");
          return Array.from(inputs).some(input => input.style.display !== "none");
        });
        if (isFormOpen) {
          return;
        }
        const template = document.getElementById("experience-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = "block";
        list.appendChild(clone);
      }

      //ê²½í—˜/?œë™/êµìœ¡ ?? œ
      function removeExperienceForm(button) {
        const entry = button.closest(".experience-entry");
        if (entry) {
          entry.remove();
        }
      }
      //ê²½í—˜/?œë™/êµìœ¡ ?€??
      function saveExperience(button) {
        const entry = button.closest(".experience-entry");
        const summary = entry.querySelector(".experience-summary");
        const inputs = entry.querySelectorAll("input, textarea, select");
        const values = {};

        // ?…ë ¥ê°?ê²€ì¦?
        const startDate = new Date(entry.querySelector('input[placeholder="?œì‘?„ì›”"]').value);
        const endDate = new Date(entry.querySelector('input[placeholder="ì¢…ë£Œ?„ì›”"]').value);

        if (startDate > endDate) {
          alert('ì¢…ë£Œ?„ì›”?€ ?œì‘?„ì›”ë³´ë‹¤ ?´í›„?¬ì•¼ ?©ë‹ˆ??');
          return;
        }

        // ?„ìˆ˜ ?…ë ¥ê°?ê²€ì¦?
        const activityType = entry.querySelector('select').value;
        const place = entry.querySelector('input[placeholder="ê¸°ê?/?¥ì†Œëª?]').value;
        const description = entry.querySelector('textarea').value;

        if (!activityType || !place || !description) {
          alert('?œë™ ? í˜•, ê¸°ê?/?¥ì†Œëª? ?œë™ ?¤ëª…?€ ?„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??');
          return;
        }

        // ê°??€??
        inputs.forEach(input => {
          if (input.tagName === 'SELECT') {
            values['?œë™ ? í˜•'] = input.options[input.selectedIndex].text;
          } else {
            values[input.placeholder] = input.value.trim();
          }
        });

        // ? ì§œ ?¬ë§·??
        const formatDate = (dateStr) => {
          if (!dateStr) return '';
          const date = new Date(dateStr);
          return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}`;
        };

        // ê²½í—˜ ?°ì´???€??
        const experienceData = {
          activityType: values['?œë™ ? í˜•'],
          place: values['ê¸°ê?/?¥ì†Œëª?],
          startDate: values['?œì‘?„ì›”'],
          endDate: values['ì¢…ë£Œ?„ì›”'],
          description: values['?œë™ ?¤ëª…']
        };

        // localStorage?ì„œ ê¸°ì¡´ ?°ì´??ê°€?¸ì˜¤ê¸?
        let experiences = JSON.parse(localStorage.getItem('experiences') || '[]');
        experiences.push(experienceData);
        localStorage.setItem('experiences', JSON.stringify(experiences));

        summary.innerHTML = `
          <div class="experience-card">
            <h4>${values['?œë™ ? í˜•'] || ''} - ${values['ê¸°ê?/?¥ì†Œëª?] || ''} 
                (${formatDate(values['?œì‘?„ì›”']) || ''} ~ ${formatDate(values['ì¢…ë£Œ?„ì›”']) || ''})</h4>
            <p><strong>?œë™ ?¤ëª…:</strong> ${values['?œë™ ?¤ëª…'] || ''}</p>
            <div class="card-buttons" style="display: flex; justify-content: flex-end; gap: 8px;">
              <button onclick="editExperience(this)" class="cencle_save_btn">?˜ì •</button>
              <button onclick="removeExperienceForm(this)" class="cencle_save_btn">?? œ</button>
            </div>
          </div>
        `;

        // ?…ë ¥ ?„ë“œ ?¨ê¸°ê¸?
        inputs.forEach(input => input.style.display = "none");

        // ??ë²„íŠ¼ ?¨ê¸°ê¸?
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        // ?”ì•½ ì¹´ë“œ ?œì‹œ
        summary.style.display = "block";
      }
      //ê²½í—˜/?œë™/êµìœ¡ ?˜ì •
      function editExperience(button) {
        const entry = button.closest(".experience-entry");
        const summary = entry.querySelector(".experience-summary");

        const inputs = entry.querySelectorAll("input, textarea, select");

        summary.style.display = "none";

        inputs.forEach(input => input.style.display = "inline-block");

        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }


      /* =========================================== ?ê²©/?´í•™/?˜ìƒ */
      let certificateData = [];
      let certEditIndex = null;
      let editingCardEl = null;

      function showcertificate(isEdit = false) {
        const form = document.getElementById('certificate-form');
        form.style.display = 'block';

        /* ????ª©?????„ì „ ì´ˆê¸°??*/
        if (!isEdit) {
          certEditIndex = null;
          resetCertForm();   // ?œë¡­?¤ìš´ ì´ˆê¸°??
        }

        showCertificateFields();   // ?€?…ë³„ ?„ë“œ ? ê?
      }
      function cancelcertificate() {
        document.getElementById('certificate-form').style.display = 'none';

        /* ???¨ê²¨??ì¹´ë“œê°€ ?ˆìœ¼ë©??¤ì‹œ ë³´ì´ê²?*/
        if (editingCardEl) {
          editingCardEl.style.display = '';
          editingCardEl = null;
          certEditIndex = null;
        }
        resetCertForm();   // ë¹???? ì?
      }
      function showCertificateFields() {
        const type = document.getElementById('certificateType').value;

        /* (A) ?„ë¬´ ê²ƒë„ ? íƒ?˜ì? ?Šì? ?íƒœë©??„ë? ê°ì¶¤ */
        if (!type) {
          document.querySelectorAll('.cert-fields').forEach(el => el.style.display = 'none');
          return;
        }

        /* (B) ? íƒê°’ì´ ?ˆì„ ?Œë§Œ ?´ë‹¹ ë¸”ë¡ ë³´ì—¬ ì¤?*/
        document.querySelectorAll('.cert-fields').forEach(el => {
          el.style.display = el.id.startsWith(type) ? 'block' : 'none';
        });
      }
      function savecertificate() {
        const type = document.getElementById('certificateType').value;
        if (!type) { alert('êµ¬ë¶„??? íƒ?˜ì„¸??); return; }

        /* ?œì„± ?„ë“œ?ì„œ ê°??˜ì§‘ */
        const visible = document.querySelector(`#${type}Fields`);
        const obj = { type };
        visible.querySelectorAll('input, select').forEach(el => obj[el.name] = el.value.trim());

        /* ê°’ì´ ?˜ë‚˜?¼ë„ ë¹„ì–´ ?ˆìœ¼ë©??€??ë§‰ê¸°(? íƒ) */
        if (Object.values(obj).some(v => v === '')) { alert('ëª¨ë“  ??ª©???…ë ¥?˜ì„¸??); return; }

        /* ????ª© vs ?˜ì • ??ª© êµ¬ë¶„ */
        if (certEditIndex === null) {
          certificateData.push(obj);
        } else {
          certificateData[certEditIndex] = obj;
        }

        renderCertificateList();      // ë¦¬ìŠ¤???¤ì‹œ ê·¸ë¦¼
        certEditIndex = null;
        editingCardEl = null;         // ??ë¦¬ì…‹
        resetCertForm();
        cancelcertificate();    // ?????¨ê?
      }
      function renderCertificateList() {
        const list = document.getElementById('certificate-list');
        list.innerHTML = '';

        certificateData.forEach((it, idx) => {
          /* ??ì¹´ë“œ div */
          const card = document.createElement('div');
          card.className = 'cert-card';

          /* ???ì„¸ ë¬¸ì??*/
          let detail = '';
          if (it.type === 'license') {
            detail = `<strong>[?ê²©ì¦?</strong> ${it.license_name} Â· ${it.issuer} (${it.pass_date})`;
          } else if (it.type === 'language') {
            detail = `<strong>[?´í•™]</strong> ${it.lang} ${it.exam} ${it.score} (${it.status})`;
          } else {
            detail = `<strong>[?˜ìƒ]</strong> ${it.award_name} Â· ${it.host} (${it.award_date})`;
          }

          /* ??ë²„íŠ¼ ë¬¶ìŒ */
          const btnBox = `
      <div class="card-actions" style="display: flex; justify-content: flex-end; gap: 8px;">
        <button class="cencle_save_btn" onclick="editCertificate(${idx})">?˜ì •</button>
        <button class="cencle_save_btn" onclick="deleteCertificate(${idx})">?? œ</button>
      </div>`;

          /* ??ì¹´ë“œ ?„ì„± & ?½ì… */
          card.innerHTML = `<span>${detail}</span>${btnBox}`;
          list.appendChild(card);
        });
      }
      function editCertificate(index) {
        certEditIndex = index;
        const it = certificateData[index];

        /* ??ì¹´ë“œ DOM??ì°¾ì•„ ?¨ê¸°ê³?ë³€?˜ì— ë³´ê? */
        editingCardEl = document.querySelectorAll('.cert-card')[index];
        if (editingCardEl) editingCardEl.style.display = 'none';

        /* ?????´ê¸° & ê°?ì£¼ì…(ê¸°ì¡´ ì½”ë“œ) */
        showcertificate(true);
        document.getElementById('certificateType').value = it.type;
        showCertificateFields();

        if (it.type === 'license') {
          ['license_name', 'issuer', 'pass_date'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        } else if (it.type === 'language') {
          ['lang', 'exam', 'score', 'status'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        } else {
          ['award_name', 'award_date', 'host'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        }
      }
      function deleteCertificate(index) {
        if (confirm('?? œ?˜ì‹œê² ìŠµ?ˆê¹Œ?')) { certificateData.splice(index, 1); renderCertificateList(); }
      }
      function resetCertForm() {
        const form = document.getElementById('certificate-form');

        /* ?œë¡­?¤ìš´ ì²?ë²ˆì§¸ ê°?*/
        document.getElementById('certificateType').selectedIndex = 0;

        /* ëª¨ë“  input ê°??œê±° */
        form.querySelectorAll('input').forEach(el => el.value = '');

        /* ?˜ë¨¸ì§€ select ??ì²?ë²ˆì§¸ ê°’ìœ¼ë¡?*/
        form.querySelectorAll('select').forEach(el => {
          if (el !== document.getElementById('certificateType')) el.selectedIndex = 0;
        });

        /* ?¸ë? ?„ë“œ ?„ë? ?¨ê? */
        document.querySelectorAll('.cert-fields').forEach(el => el.style.display = 'none');
      }

      /* ======================================= ì·¨ì—…?°ë??¬í•­ */
      let preferenceData = [];
      let prefEditIndex  = null;
      let prefCardHidden = null;

      /* ?????´ê¸° */
      function showPreference(isEdit=false){
        const form = document.getElementById('preference-form');
        form.style.display='block';

        if(!isEdit){
          prefEditIndex = null;           
          prefCardHidden = null;
          resetPrefForm();
        }
        showPreferenceFields();
      }

      /* ?????«ê¸° */
      function cancelPreference(){
        document.getElementById('preference-form').style.display='none';
        if(prefCardHidden){ prefCardHidden.style.display=''; prefCardHidden=null; }
        prefEditIndex=null;
        resetPrefForm();
      }

      /* ???œë¡­?¤ìš´??ë§ì¶° ë¶€ë¶??„ë“œ ? ê? */
      function showPreferenceFields(){
        const type = document.getElementById('preferenceType').value;
        if(!type){
          document.querySelectorAll('.pref-fields').forEach(el=>el.style.display='none');
          return;
        }
        document.querySelectorAll('.pref-fields').forEach(el=>{
          el.style.display = el.id.startsWith(type)?'block':'none';
        });
      }

      /* ???€??*/
      function savePreference() {
        const type = document.getElementById('preferenceType').value;
        if (!type) {
          alert('êµ¬ë¶„ ? íƒ');
          return;
        }

        const obj = { type };

        if (type === 'veteran') {
          obj.v_type = document.querySelector('[name="v_type"]').value.trim();
          obj.v_cert = document.querySelector('[name="v_cert"]').value.trim();

          if (!obj.v_type || !obj.v_cert) {
            alert('ëª¨ë“  ??ª© ?…ë ¥');
            return;
          }

        } else if (type === 'military') {
          obj.m_status = document.querySelector('[name="m_status"]').value.trim();

          if (!obj.m_status) {
            alert('ë³‘ì—­ êµ¬ë¶„ ?…ë ¥');
            return;
          }

          // êµ°í•„??ê²½ìš°?ë§Œ ì¶”ê? ?„ë“œ ?…ë ¥ ë°›ê¸°
          if (obj.m_status === 'served') {
            obj.m_start = document.querySelector('[name="m_start"]').value.trim();
            obj.m_end = document.querySelector('[name="m_end"]').value.trim();
            obj.m_branch = document.querySelector('[name="m_branch"]').value.trim();
            obj.m_rank = document.querySelector('[name="m_rank"]').value.trim();
            obj.m_reason = document.querySelector('[name="m_reason"]').value.trim();

            if (!obj.m_start || !obj.m_end || !obj.m_branch || !obj.m_rank || !obj.m_reason) {
              alert('êµ°í•„ ??ª© ëª¨ë‘ ?…ë ¥?˜ì„¸??);
              return;
            }
          }

        } else if (type === 'employment') {
          obj.e_type = document.querySelector('[name="e_type"]').value.trim();
          if (!obj.e_type) {
            alert('ì§€?ê¸ˆ ì¢…ë¥˜ ?…ë ¥');
            return;
          }
        }

        if (prefEditIndex === null) {
          preferenceData.push(obj);
        } else {
          preferenceData[prefEditIndex] = obj;
        }

        renderPreferenceList();
        prefEditIndex = null;
        prefCardHidden = null;
        resetPrefForm();
        cancelPreference();
      }


      /* ??ì¹´ë“œ ?Œë” */
      function renderPreferenceList(){
        const list=document.getElementById('preference-list');
        list.innerHTML='';

        preferenceData.forEach((it,idx)=>{
          let detail='';
          if(it.type==='veteran')    detail=`[ë³´í›ˆ] ${it.v_type} (ì¦ì„œ: ${it.v_cert})`;
          else if(it.type==='military'){
          if(it.m_status==='served'){
            detail = `[êµ°í•„] ${it.m_branch}Â·${it.m_rank} (${it.m_start}~${it.m_end}) / ${it.m_reason}`;
          }else{
            detail = `[ë³‘ì—­] ${it.m_status}`;   // ë©´ì œÂ·ë¯¸í•„
          }
        }
          else detail=`[ì§€?ê¸ˆ] ${it.e_type}`;

          const card=document.createElement('div');
          card.className='pref-card';
          card.innerHTML=`
            <span>${detail}</span>
            <div class="card-actions">
              <button class="cencle_save_btn" onclick="editPreference(${idx})">?˜ì •</button>
              <button class="cencle_save_btn" onclick="deletePreference(${idx})">?? œ</button>
            </div>`;
          list.appendChild(card);
        });
      }

      /* ???˜ì • */
      function editPreference(idx){
        prefEditIndex = idx;
        prefCardHidden = document.querySelectorAll('.pref-card')[idx];
        if(prefCardHidden) prefCardHidden.style.display='none';

        const it = preferenceData[idx];
        showPreference(true);

        document.getElementById('preferenceType').value=it.type;
        showPreferenceFields();

        if(it.type==='veteran'){
          document.querySelector('[name="v_type"]').value = it.v_type;
          document.querySelector('[name="v_cert"]').value = it.v_cert;
        }else if(it.type==='military'){
          document.querySelector('[name="m_status"]').value = it.m_status;
        }else{
          document.querySelector('[name="e_type"]').value = it.e_type;
        }
      }   

      /* ???? œ */
      function deletePreference(idx){
        if(confirm('?? œ?˜ì‹œê² ìŠµ?ˆê¹Œ?')){
          preferenceData.splice(idx,1);
          renderPreferenceList();
        }
      }

      /* ????ë¦¬ì…‹ */
      function resetPrefForm(){
        const form=document.getElementById('preference-form');
        document.getElementById('preferenceType').selectedIndex=0;
        form.querySelectorAll('input').forEach(el=>el.value='');
        form.querySelectorAll('select').forEach(el=>{
          if(el!==document.getElementById('preferenceType')) el.selectedIndex=0;
        });
        document.querySelectorAll('.pref-fields').forEach(el=>el.style.display='none');
      }

      /* ë³‘ì—­ êµ¬ë¶„ ? íƒ ??êµ°í•„ ?ì„¸ ?…ë ¥ ?¸ì¶œ */
      function toggleMilitaryDetail(){
        const val = document.getElementById('mStatus').value;
        document.getElementById('servedDetail').style.display = (val === 'served') ? 'inline-block' : 'none';
      }

      //?¬íŠ¸?´ë¦¬??
      function showPortfolioForm() {
        const list = document.getElementById('portfolio-list');

        // ?¼ì´ ?¤ì œë¡??´ë ¤ ?ˆëŠ”ì§€ ?•ì¸: ?…ë ¥?€??ë³´ì´??entryë§?
        const isFormOpen = Array.from(list.querySelectorAll('.portfolio-entry')).some(entry => {
          const inputs = entry.querySelectorAll('input, textarea');
          return Array.from(inputs).some(input => input.style.display !== 'none');
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById('portfolio-form-template').firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = 'block';
        list.appendChild(clone);
      }
      //?¬í´ ?? œ
      function removePortfolioForm(button) {
        const entry = button.closest(".portfolio-entry");
        if (entry) {
          entry.remove();
        }
      }
      //?¬í´ ?€??
      function savePortfolio(button) {
        const entry = button.closest(".portfolio-entry");
        const summary = entry.querySelector(".portfolio-summary");

        const inputs = entry.querySelectorAll("input, textarea");
        const fileInput = entry.querySelector(".file-input");

        const values = {};
        inputs.forEach(input => {
          if (input.type !== "file") {
            values[input.placeholder] = input.value;
          }
        });

        // ?Œì¼ ?´ë¦„ ëª©ë¡ ?ì„±
        const fileNames = [];
        for (let i = 0; i < fileInput.files.length; i++) {
          fileNames.push(fileInput.files[i].name);
        }

        summary.innerHTML = `
    <div class="portfolio-card">
      <h4>${values['?„ë¡œ?íŠ¸ëª?] || ''}</h4>
      <p><strong>?¤ëª…:</strong> ${values['?„ë¡œ?íŠ¸ ?¤ëª…'] || ''}</p>
      ${fileNames.length > 0 ? `<p><strong>ì²¨ë??Œì¼:</strong> ${fileNames.join(', ')}</p>` : ''}
      <div style="display: flex; justify-content: flex-end; gap: 8px;">
        <button onclick="editPortfolio(this)" class="cencle_save_btn">?˜ì •</button>
        <button onclick="removePortfolioForm(this)" class="cencle_save_btn">?? œ</button>
      </div>
    </div>
  `;

        if (!values['?„ë¡œ?íŠ¸ëª?] || !values['?„ë¡œ?íŠ¸ ?¤ëª…']) {
          alert('?„ë¡œ?íŠ¸ëª? ?„ë¡œ?íŠ¸ ?¤ëª…?€ ?„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??');
          return;
        }

        inputs.forEach(input => input.style.display = "none");
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        summary.style.display = "block";
      }
      //?¬í´ ?˜ì •
      function editPortfolio(button) {
        const entry = button.closest(".portfolio-entry");
        const summary = entry.querySelector(".portfolio-summary");

        const inputs = entry.querySelectorAll("input, textarea");
        summary.style.display = "none";

        inputs.forEach(input => input.style.display = "inline-block");

        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }


      //ê²½ë ¥ê¸°ìˆ ??
      function showdescription() {
        document.getElementById('career-description-form').style.display = 'block';
      }
      function canceldescription() {
        document.getElementById('career-description-form').style.display = 'none';
        document.getElementById("careerDescriptionText").value = "";
        updateCharCount();
      }
      function updateCharCount() {
        const textArea = document.getElementById("careerDescriptionText");
        if (!textArea) return;  // ?ìŠ¤???ì—­???„ì§ ?†ìœ¼ë©?ê·¸ëƒ¥ ?¨ìˆ˜ ì¢…ë£Œ

        const text = textArea.value;
        const total = text.length;
        const noSpace = text.replace(/\s/g, "").length;
        const byteSize = new Blob([text]).size;
        const byteNoSpace = new Blob([text.replace(/\s/g, "")]).size;

        const totalChars = document.getElementById("totalChars");
        const totalBytes = document.getElementById("totalBytes");
        const noSpaceChars = document.getElementById("noSpaceChars");
        const noSpaceBytes = document.getElementById("noSpaceBytes");

        if (totalChars) totalChars.innerText = total;
        if (totalBytes) totalBytes.innerText = byteSize;
        if (noSpaceChars) noSpaceChars.innerText = noSpace;
        if (noSpaceBytes) noSpaceBytes.innerText = byteNoSpace;
      }


      function savedescription() {
        const text = document.getElementById("careerDescriptionText").value;
        if (!text.trim()) {
          alert("?´ìš©???…ë ¥?˜ì„¸??");
          return;
        }

        const summaryContainer = document.createElement("div");
        summaryContainer.className = "career-desc-card";
        summaryContainer.innerHTML = `
          <div style="white-space: pre-wrap;">${text}</div>
          <div style="margin-top: 10px; text-align: right;">
            <button onclick="editDescription(this)" class="cencle_save_btn">?˜ì •</button>
            <button onclick="removeDescription(this)" class="cencle_save_btn">?? œ</button>
          </div>
        `;

        document.getElementById("career-description-list").appendChild(summaryContainer);
        document.getElementById("careerDescriptionText").value = "";
        document.getElementById("career-description-form").style.display = "none";
        updateCharCount();
      }



      function editDescription(button) {
        const card = button.closest(".career-desc-card");
        if (!card) return;

        const content = card.querySelector("div").innerText;
        document.getElementById("careerDescriptionText").value = content;
        document.getElementById("career-description-form").style.display = "block";

        card.remove();
        updateCharCount();
      }

      function removeDescription(button) {
        const card = button.closest(".career-desc-card");
        if (!card) return;
        card.remove();
      }
      const text = document.getElementById("careerDescriptionText").value;

      function insertTemplate(type) {
        const textarea = document.getElementById("careerDescriptionText");
        let content = "";

        switch (type) {
          case "project":
            content =
              `1) ?„ë¡œ?íŠ¸ëª?

    - ?°ê³„/?Œì†?Œì‚¬ : (?°ê³„/?Œì†?Œì‚¬ê°€ ?†ì„ ê²½ìš°, ?´ë‹¹ ??ª©??ì§€?°ê³  ?‘ì„±?˜ì„¸??
    - ?˜í–‰ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (??Nê°œì›”)
    - ì£¼ìš” ??•  : ?”ë©´ ?¤ê³„ ë°??œë¹„??ê¸°íš
    - ?…ë¬´ ?±ê³¼ :`;
            break;

          case "dev":
            content =
              `1) ?„ë¡œ?íŠ¸ëª?

    - ?°ê³„/?Œì†?Œì‚¬ : (?°ê³„/?Œì†?Œì‚¬ê°€ ?†ì„ ê²½ìš°, ?´ë‹¹ ??ª©??ì§€?°ê³  ?‘ì„±?˜ì„¸??
    - ì£¼ìš” ?…ë¬´ : ë°±ì—”???´ë‹¹
    - ?´ë‹¹ ??•  :
    - ê¸°ìˆ  ?¤íƒ : (?´ì˜ì²´ì œ, ê°œë°œ?¸ì–´, ?°ì´?°ë² ?´ìŠ¤ ??
    - ?…ë¬´ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (??Nê°œì›”)
    - ê°œë°œ ?¸ì› :
    - ?ì„¸ ?´ìš© :`;
            break;

          case "design":
            content =
              `1) ì£¼ìš” ?…ë¬´ : ì½˜í…ì¸??œì‘

    - ?¬ìš© Tool : ex) photoshop
    - ?…ë¬´ê¸°ê°„ : YYYY.MM ~ YYYY.MM (??Nê°œì›”)
    - ?¬íŠ¸?´ë¦¬??URL :
    - ?ì„¸?´ìš© :`;
            break;

          case "sales":
            content =
              `1) ?„ë¡œ?íŠ¸ëª?

    - ?°ê³„/?Œì†?Œì‚¬ : (?°ê³„/?Œì†?Œì‚¬ê°€ ?†ì„ ê²½ìš°, ?´ë‹¹ ??ª©??ì§€?°ê³  ?‘ì„±?˜ì„¸??
    - ì£¼ìš” ?…ë¬´ :
    - ?˜í–‰ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (??Nê°œì›”)
    - ?´ë‹¹ ì§€??:
    - ê³„ì•½ ê±´ìˆ˜ : ???‰ê·  _ê±?
    - ê³ ê° ??: ex. ?¸ìˆ˜ 30%, ? ê·œê°œì²™ 70%
    - ?ì„¸ ?´ìš© :`;
            break;
        }

        textarea.value = content;
        updateCharCount();
      }

      
      //?ê¸°?Œê°œ??

      function collectIntroductionData() {
        const cards = document.querySelectorAll('.intro-card');
        return Array.from(cards).map(card => ({
          title: card.querySelector('h4').innerText,
          content: card.querySelector('.intro-content').innerText
        }));
      }

      
      function showintroduction() {
        document.getElementById('introduction-form').style.display = 'block';

      }
      function updateIntroCount() {
        const text = document.getElementById("introTextarea").value;
        const chars = text.length;
        const bytes = new Blob([text]).size;
        document.getElementById("introChars").innerText = chars;
        document.getElementById("introBytes").innerText = bytes;
      }
      

      async function postJSON(url, payload){
        const resp = await fetch(url, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error(await resp.text());
        return resp.json();
      }

      /* ë§ì¶¤ë²?*/
      async function checkSpelling(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("?´ìš©??ë¨¼ì? ?…ë ¥?˜ì„¸??); return; }

        try{
          const data = await postJSON("/api/spellcheck/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("ë§ì¶¤ë²?êµì • ?„ë£Œ!");
        }catch(e){
          console.error(e); alert("êµì • ?¤íŒ¨");
        }
      }

      /* AI ì²¨ì‚­ */
      async function runAIReview(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("?´ìš©??ë¨¼ì? ?…ë ¥?˜ì„¸??); return; }

        try{
          const data = await postJSON("/api/proofread/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("AI ì²¨ì‚­ ?„ë£Œ!");
        }catch(e){
          console.error(e); alert("ì²¨ì‚­ ?¤íŒ¨");
        }
      }

      window.onload = () => {
        const resumes = JSON.parse(localStorage.getItem('resumeList')) || [];
        resumes.forEach(resume => addToResumeList(resume.basicInfo.title));
      };


      function resetResumeForm() {
        // 1. ê¸°ë³¸ ?•ë³´ ?…ë ¥?€ ë¹„ìš°ê¸?
        document.getElementById('resume-title').value = '';
        document.getElementById('name').value = '';
        document.getElementById('gender').value = '';
        document.getElementById('birthdate').value = '';
        document.getElementById('email').value = '';
        document.getElementById('phone').value = '';
        document.getElementById('address').value = '';
        document.getElementById('detail-address').value = '';

        // 2. ì²´í¬ë°•ìŠ¤ ëª¨ë‘ ?´ì œ + ??ëª¨ë‘ ?«ê¸°
        const sectionNames = [
          'education', 'career', 'skill', 'experience', 'certificate',
          'preference', 'portfolio', 'career-description', 'introduction'
        ];
        sectionNames.forEach(key => {
          const cb = document.getElementById(`section-${key}`);
          const section = document.getElementById(`${key}-section`);
          if (cb) cb.checked = false;
          if (section) section.style.display = 'none';
        });

        // 3. ê°???ª© ë¦¬ìŠ¤??ë¹„ìš°ê¸?
        // ?™ë ¥/ê²½ë ¥/?¤í‚¬ ??ë¦¬ìŠ¤??ë¶€ë¶?ì´ˆê¸°??
        const sectionListIds = [
          'education-list', 'career-list', 'skill-list', 'experience-list',
          'certificate-list', 'preference-list', 'portfolio-list',
          'career-description-list', 'introduction-list'
        ];
        sectionListIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.innerHTML = '';
        });

        // 4. ?¤í‚¬ ?œê·¸ ì´ˆê¸°??
        selectedSkills = [];
        updateSkillList();

        // 5. ê¸°í?(?¬íŠ¸?´ë¦¬?? ê²½ë ¥ê¸°ìˆ ?????„ì‹œ ?…ë ¥?¼ë„ ?«ê¸°)
        const formIds = [
          'education-form-template', 'career-form-template', 'skill-form',
          'experience-form-template', 'certificate-form', 'preference-form',
          'portfolio-form-template', 'career-description-form', 'introduction-form'
        ];
        formIds.forEach(fid => {
          const f = document.getElementById(fid);
          if (f) f.style.display = 'none';
        });

        // 6. sectionData ???°ì´??ë°°ì—´?¤ë„ ë¹„ìš¸ ê²??ˆìœ¼ë©??¬ê¸°??ë¹„ìš°ê¸?
        // ?? certificateData = [], preferenceData = []

        if (typeof certificateData !== 'undefined') certificateData = [];
        if (typeof preferenceData !== 'undefined') preferenceData = [];

        // 7. ?´ë?ì§€ ì´ˆê¸°??
        // ?„ë¡œ???´ë?ì§€ ì´ˆê¸°??
        const previewDiv = document.getElementById("profile-image-preview");
        const fileInput = document.getElementById("profile-image-input");
        const uploadPlus = document.getElementById("upload-plus");

        if (previewDiv) {
          previewDiv.style.backgroundImage = '';
        }
        if (uploadPlus) {
          uploadPlus.style.display = 'inline';
        }
        if (fileInput) {
          fileInput.value = '';  // input[type=file] ì´ˆê¸°??
}


      
      }

      //?ê¸°?Œê°œ??
      function showIntroductionForm() {
        document.getElementById("introduction-form").style.display = "block";
      }

      function cancelIntroductionForm() {
        document.getElementById("introduction-form").style.display = "none";
        document.getElementById("introTitle").value = "";
        document.getElementById("introTextarea").value = "";
        updateIntroCount();
      }

      function saveIntroductionForm() {
        const title = document.getElementById("introTitle").value.trim();
        const content = document.getElementById("introTextarea").value.trim();
        if (!title || !content) {
          alert("?œëª©ê³??´ìš©??ëª¨ë‘ ?…ë ¥?˜ì„¸??");
          return;
        }

        const contentHTML = content.replace(/\n/g, "<br>");

        const card = document.createElement("div");
        card.className = "intro-card";
        card.style.padding = "10px";
        card.style.marginTop = "10px";
        card.style.display = "block";  
        card.innerHTML = `
          <h4 style="margin-bottom: 10px;">${title}</h4>
          <div class="intro-content" style="white-space: pre-wrap; margin-bottom: 20px;">${contentHTML}</div>
          <div style="text-align: right; margin-top: 10px;">
            <button onclick="editIntroduction(this)" class="cencle_save_btn">?˜ì •</button>
            <button onclick="removeIntroduction(this)" class="cencle_save_btn">?? œ</button>
          </div>
        `;
        document.getElementById("introduction-list").appendChild(card);
        cancelIntroductionForm();
      }
      function editIntroduction(button) {
        const card = button.closest(".intro-card");
        const title = card.querySelector("h4").innerText;
        const content = card.querySelector(".intro-content").innerText; 
        document.getElementById("introTitle").value = title;
        document.getElementById("introTextarea").value = content;
        document.getElementById("introduction-form").style.display = "block";
        card.remove();
        updateIntroCount();
      }
      function removeIntroduction(button) {
        const card = button.closest(".intro-card");
        if (confirm("?•ë§ ?? œ?˜ì‹œê² ìŠµ?ˆê¹Œ?")) {
          card.remove();
        }
      }
      function updateIntroCount() {
        const text = document.getElementById("introTextarea").value;
        const chars = text.length;
        const bytes = new Blob([text]).size;
        document.getElementById("introChars").innerText = chars;
        document.getElementById("introBytes").innerText = bytes;
      }
      

      async function postJSON(url, payload){
        const resp = await fetch(url, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error(await resp.text());
        return resp.json();
      }

      /* ë§ì¶¤ë²?*/
      async function checkSpelling(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("?´ìš©??ë¨¼ì? ?…ë ¥?˜ì„¸??); return; }

        try{
          const data = await postJSON("/api/spellcheck/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("ë§ì¶¤ë²?êµì • ?„ë£Œ!");
        }catch(e){
          console.error(e); alert("êµì • ?¤íŒ¨");
        }
      }

      /* AI ì²¨ì‚­ */
      async function runAIReview(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("?´ìš©??ë¨¼ì? ?…ë ¥?˜ì„¸??); return; }

        try{
          const data = await postJSON("/api/proofread/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("AI ì²¨ì‚­ ?„ë£Œ!");
        }catch(e){
          console.error(e); alert("ì²¨ì‚­ ?¤íŒ¨");
        }
      }

      
      // ?´ë?ì§€ ? íƒ ??ë¯¸ë¦¬ë³´ê¸°ë¡??œì‹œ
      function previewProfileImage(event) {
        const input = event.target;
        const previewDiv = document.getElementById("profile-image-preview");

        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewDiv.style.backgroundImage = `url('${e.target.result}')`;
            document.getElementById("upload-plus").style.display = 'none';  // + ë²„íŠ¼ ?¨ê?
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      // div ?´ë¦­ ???Œì¼ ? íƒ input ?´ê¸°
      document.getElementById("profile-image-preview").addEventListener("click", function() {
        document.getElementById("profile-image-input").click();
      });





      function previewResume() {
        if (selectedResumeId) {
          // ?´ë? ?€?¥ëœ ?´ë ¥?œë? ? íƒ???íƒœ??ê²½ìš° ??GET ?”ì²­?¼ë¡œ ë¯¸ë¦¬ë³´ê¸°
          window.open(`/resume/preview/${selectedResumeId}/`, '_blank');
          return;
        }
        const title = document.getElementById('resume-title').value;
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const birthdate = document.getElementById('birthdate').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const detailAddress = document.getElementById('detail-address').value;

        const sectionCheckboxStates = getSectionCheckboxStates();
        const sections = {
          education: collectEducationData() || [],
          career: collectCareerData() || [],
          experience: collectExperienceData() || [],
          certificate: collectCertificateData() || [],
          preference: collectPreferenceData() || [],
          portfolio: collectPortfolioData() || [],
          description: collectCareerDescriptionData() || [],
          introduction: collectIntroductionData() || [],
          skills: selectedSkills || [],
          sectionCheckboxStates: sectionCheckboxStates
        };

        const formData = new URLSearchParams();
        formData.append("title", title);
        formData.append("name", name);
        formData.append("gender", gender);
        formData.append("birthdate", birthdate);
        formData.append("email", email);
        formData.append("phone", phone);
        formData.append("address", address);
        formData.append("detail-address", detailAddress);
        formData.append("sections_json", JSON.stringify(sections));

        fetch('/save_resume/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken'),
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.resume_id) {
            window.open(`/resume/preview/${data.resume_id}/`, '_blank');
          } else {
            alert("?´ë ¥???€?¥ì— ?¤íŒ¨?ˆìŠµ?ˆë‹¤.");
          }
        })
        .catch(err => {
          alert("ë¯¸ë¦¬ë³´ê¸° ?¤íŒ¨: " + err);
        });
      }



    </script>
</body>

</html>
