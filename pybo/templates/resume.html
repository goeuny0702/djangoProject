{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ì´ë ¥ì„œ ì‘ì„±</title>
  <link rel="stylesheet" href="{% static 'main.css' %}">
</head>

<body>
  <div class="mycontainer">
    <div class="namecontainer">
      <h1>{{ user.username }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ â™¡</h1>
    </div>
    <div class="logoutcontainer">
      <div class="logoutbtn"><a href="{% url 'logout' %}">ë¡œê·¸ì•„ì›ƒ</a></div>
    </div>
    <div class="writecontainer">
      <div class="writebtn"><a href="#" onclick="resetResumeForm(); return false;">ì´ë ¥ì„œ ë“±ë¡</a></div>
    </div>
    <div class="sidebar">
      <div class="resume-management">ì´ë ¥ì„œ ê´€ë¦¬</div>
      <div class="resume-list">
        {% for resume in resumes %}
          <div class="resume-item" style="position: relative; padding: 5px;" onmouseenter="this.querySelector('.delete-btn').style.display='inline'" onmouseleave="this.querySelector('.delete-btn').style.display='none'">
            <span onclick="loadResumeFromServer('{{ resume.id }}')" style="cursor: pointer;">
              {{ resume.title }}
            </span>
            <button class="delete-btn" onclick="deleteResume('{{ resume.id }}')" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); display: none; background: #f8d7da; border: none; color: #721c24; padding: 2px 6px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
          </div>
        {% empty %}
          <p>ì‘ì„±í•œ ì´ë ¥ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>
  </div>
  
    

  </div>
  <div class="main">
    <div style="display: flex; justify-content: center;">
      <input type="text" placeholder="ì´ë ¥ì„œ ì œëª©" class="input-title" id="resume-title" name="title"><br>
    </div>
    <!-- ê¸°ë³¸ì •ë³´ ì¹´ë“œ -->
    <div class="basic-info-card">
      <div class="basic-info-header">
        <span class="header-icon">ğŸ“‹</span>
        <h2>ê¸°ë³¸ì •ë³´</h2>
        <span class="required-notice">* í•„ìˆ˜ ì…ë ¥ì‚¬í•­</span>
      </div>
      
      <div class="basic-info-content">
        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì˜ì—­ -->
        <div class="profile-section">
          <div id="profile-image-preview" class="profile-image-box">
            {% if resume.profile_image %}
            <script>
              document.addEventListener("DOMContentLoaded", function() {
                document.getElementById("profile-image-preview").style.backgroundImage = "url('{{ resume.profile_image.url }}')";
                document.getElementById("upload-plus").style.display = 'none';
              });
            </script>
            {% endif %}
            <div id="upload-plus" class="upload-placeholder">
              <span class="camera-icon">ğŸ“·</span>
              <span class="upload-text">ì‚¬ì§„ ë“±ë¡</span>
            </div>
          </div>
          <input type="file" id="profile-image-input" name="profile_image" style="display: none;" accept="image/*" onchange="previewProfileImage(event)">
          <p class="photo-guide">3x4 ì¦ëª…ì‚¬ì§„ ê¶Œì¥</p>
        </div>

        <!-- ì¸ì ì‚¬í•­ ì…ë ¥ ì˜ì—­ -->
        <div class="info-fields-section">
          <!-- ì¸ì ì‚¬í•­ ê·¸ë£¹ -->
          <div class="info-group">
            <div class="group-title">
              <span class="group-icon">ğŸ‘¤</span>
              <span>ì¸ì ì‚¬í•­</span>
            </div>
            <div class="fields-grid">
              <div class="field-row">
                <label class="field-label required">ì´ë¦„</label>
                <input type="text" class="field-input" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              <div class="field-row">
                <label class="field-label">ì„±ë³„</label>
                <select class="field-input field-select" id="gender">
                  <option value="">ì„ íƒ</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                </select>
              </div>
              <div class="field-row">
                <label class="field-label required">ìƒë…„ì›”ì¼</label>
                <input type="date" class="field-input" id="birthdate">
              </div>
            </div>
          </div>

          <!-- ì—°ë½ì²˜ ê·¸ë£¹ -->
          <div class="info-group">
            <div class="group-title">
              <span class="group-icon">ğŸ“</span>
              <span>ì—°ë½ì²˜</span>
            </div>
            <div class="fields-grid">
              <div class="field-row">
                <label class="field-label required">ì´ë©”ì¼</label>
                <input type="email" class="field-input" id="email" placeholder="example@email.com">
              </div>
              <div class="field-row">
                <label class="field-label required">íœ´ëŒ€í°</label>
                <input type="tel" class="field-input" id="phone" placeholder="010-0000-0000">
              </div>
            </div>
          </div>

          <!-- ì£¼ì†Œ ê·¸ë£¹ -->
          <div class="info-group">
            <div class="group-title">
              <span class="group-icon">ğŸ </span>
              <span>ì£¼ì†Œ</span>
            </div>
            <div class="fields-grid address-grid">
              <div class="field-row full-width">
                <label class="field-label">ì£¼ì†Œ</label>
                <input type="text" class="field-input" id="address" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              <div class="field-row full-width">
                <label class="field-label">ìƒì„¸ì£¼ì†Œ</label>
                <input type="text" class="field-input" id="detail-address" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!--í•™ë ¥-->
    <div class="section" id="education-section" style="display: none;">
      <div class="section-header"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
        <div class="section-title">í•™ë ¥</div>
        <button class="addbtn" onclick="showEducationForm()">+ì¶”ê°€</button>
      </div>
      <div id="education-list"></div>
    </div>
    <div id="education-form-template" style="display: none;">
      <div class="education-entry" style="margin: 5px;">
        <!-- ì €ì¥ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ì˜ì—­ -->
        <div class="education-summary" style="display: none;"></div>
        <input type="text" placeholder="í•™êµëª…" class="text_input">
        <select class="text_input" id="education-select">
          <option>ì¡¸ì—…</option>
          <option>ì¬í•™ì¤‘</option>
          <option>íœ´í•™ì¤‘</option>
        </select>
        <input type="date" placeholder="ì…í•™ë…„ë„" class="text_input datepicker">
        <input type="date" placeholder="ì¡¸ì—…ë…„ë„" class="text_input datepicker"><br>
        <input type="text" placeholder="ì „ê³µ" class="text_input">
        <input type="text" placeholder="í•™ì " class="text_input">
        <div class="form-buttons">
          <button onclick="removeEducationForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveEducation(this)" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!--ê²½ë ¥-->
    <div class="section" id="career-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½ë ¥</div>
        <button class="addbtn" onclick="showCareerForm()">+ì¶”ê°€</button>
      </div>
      <div id="career-list"></div>
    </div>
    <div id="career-form-template" style="display: none;">
      <div class="career-entry">
        <!-- ì €ì¥ ê²°ê³¼ í‘œì‹œ -->
        <div class="career-summary" style="display: none;"></div>

        <input type="text" placeholder="íšŒì‚¬ëª…" class="text_input">
        <input type="date" placeholder="ì…ì‚¬ë…„ì›”" class="text_input datepicker">
        <input type="date" placeholder="í‡´ì‚¬ë…„ì›”" class="text_input datepicker"><br>
        <input type="text" placeholder="ì§ë¬´" class="text_input">
        <input type="text" placeholder="ê·¼ë¬´ë¶€ì„œ" class="text_input">
        <input type="text" placeholder="ì§ê¸‰" class="text_input"><br>
        <textarea placeholder="ë‹´ë‹¹ì—…ë¬´" class="longtext"></textarea>

        <div class="form-buttons">
          <button onclick="removeCareerForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveCareer(this)" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!-- ìŠ¤í‚¬ -->
    <div class="section" id="skill-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ìŠ¤í‚¬</div>
        <button class="addbtn" onclick="showskill()">+ì¶”ê°€</button>
      </div>
      <div id="skill-list" style="margin: 10px 0;"></div>

      <div id="skill-form" style="display: none;">
        <div class="skill-search">
          <input type="text" id="skillSearch" placeholder="ê¸°ìˆ  ê²€ìƒ‰..." onkeyup="searchSkills()" autocomplete="off">
          <div id="skillSuggestions" class="suggestions" style="border: 1px solid #ccc; display: none;"></div>
        </div>
        <div class="form-buttons">
          <button onclick="cancelskill()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveskill()" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!-- ê²½í—˜/í™œë™/êµìœ¡ -->
    <div class="section" id="experience-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½í—˜/í™œë™/êµìœ¡</div>
        <button class="addbtn" onclick="showExperienceForm()">+ì¶”ê°€</button>
      </div>
      <div id="experience-list"></div>
    </div>
    <!-- ê²½í—˜ í…œí”Œë¦¿ -->
    <div id="experience-form-template" style="display: none;">
      <div class="experience-entry">
        <div class="experience-summary" style="display: none;"></div>

        <select class="text_input">
          <option value="">í™œë™ ìœ í˜• ì„ íƒ</option>
          <option value="campus">êµë‚´í™œë™</option>
          <option value="volunteer">ìì›ë´‰ì‚¬</option>
          <option value="intern">ì¸í„´</option>
          <option value="club">ë™ì•„ë¦¬</option>
          <option value="parttime">ì•„ë¥´ë°”ì´íŠ¸</option>
          <option value="social">ì‚¬íšŒí™œë™</option>
          <option value="project">ìˆ˜í–‰ê³¼ì œ</option>
          <option value="overseas">í•´ì™¸ì—°ìˆ˜</option>
          <option value="education">êµìœ¡ì´ìˆ˜ë‚´ì—­</option>
        </select>
        <input type="text" placeholder="ê¸°ê´€/ì¥ì†Œëª…" class="text_input"><br>
        <input type="date" placeholder="ì‹œì‘ë…„ì›”" class="text_input datepicker">
        <input type="date" placeholder="ì¢…ë£Œë…„ì›”" class="text_input datepicker"><br>
        <textarea placeholder="í™œë™ ì„¤ëª…" class="longtext"></textarea>

        <div class="form-buttons">
          <button onclick="removeExperienceForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveExperience(this)" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!-- ================= ìê²©/ì–´í•™/ìˆ˜ìƒ ================= -->
    <div class="section" id="certificate-section" style="display:none;">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:center;">
        <div class="section-title">ìê²©/ì–´í•™/ìˆ˜ìƒ</div>
        <button class="addbtn" onclick="showcertificate(false)">+ì¶”ê°€</button>
      </div>

      <!-- ì €ì¥ëœ ì¹´ë“œê°€ ìŒ“ì´ëŠ” ê³³ -->
      <div id="certificate-list"></div>

      <!-- ì…ë ¥ í¼ -->
      <div id="certificate-form" style="display:none;">
        <select id="certificateType" class="text_input" onchange="showCertificateFields()">
          <option value="">êµ¬ë¶„ ì„ íƒ</option>
          <option value="license">ìê²©ì¦</option>
          <option value="language">ì–´í•™</option>
          <option value="award">ìˆ˜ìƒ</option>
        </select>

        <!-- ìê²©ì¦ -->
        <div id="licenseFields" class="cert-fields" style="display:none;">
          <input name="license_name" type="text" placeholder="ìê²©ì¦ëª…" class="text_input">
          <input name="issuer" type="text" placeholder="ë°œí–‰ì²˜" class="text_input">
          <input name="pass_date" type="month" class="text_input" placeholder="í•©ê²©ë…„ì›”">
        </div>

        <!-- ì–´í•™ -->
        <div id="languageFields" class="cert-fields" style="display:none;">
          <select name="lang" class="text_input">
            <option>ì˜ì–´</option>
            <option>ì¼ë³¸ì–´</option>
            <option>ì¤‘êµ­ì–´</option>
          </select>
          <input name="exam" type="text" placeholder="ì–´í•™ì‹œí—˜ëª…" class="text_input">
          <input name="score" type="text" placeholder="ê¸‰ìˆ˜/ì ìˆ˜" class="text_input">
          <select name="status" class="text_input">
            <option>ì·¨ë“</option>
            <option>ë¯¸ì·¨ë“</option>
          </select>
        </div>

        <!-- ìˆ˜ìƒ -->
        <div id="awardFields" class="cert-fields" style="display:none;">
          <input name="award_name" type="text" placeholder="ìˆ˜ìƒ/ê³µëª¨ì „ëª…" class="text_input">
          <input name="award_date" type="date" class="text_input" placeholder="ìˆ˜ìƒì¼">
          <input name="host" type="text" placeholder="ìˆ˜ì—¬/ì£¼ìµœê¸°ê´€" class="text_input">
        </div>

        <div class="form-buttons">
          <button onclick="cancelcertificate()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savecertificate()" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!-- ================= ì·¨ì—…ìš°ëŒ€ì‚¬í•­ ================= -->
    <div class="section" id="preference-section" style="display:none;">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:center;">
        <div class="section-title">ì·¨ì—…ìš°ëŒ€ì‚¬í•­</div>
        <button class="addbtn" onclick="showPreference(false)">+ì¶”ê°€</button>
      </div>

      <!-- ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
      <div id="preference-list"></div>

      <!-- ì…ë ¥ í¼ -->
      <div id="preference-form" style="display:none;">
        <select id="preferenceType" class="text_input" onchange="showPreferenceFields()">
          <option value="">êµ¬ë¶„ ì„ íƒ</option>
          <option value="veteran">ë³´í›ˆëŒ€ìƒ</option>
          <option value="military">ë³‘ì—­ëŒ€ìƒ</option>
          <option value="employment">ê³ ìš©ì§€ì›ê¸ˆ</option>
        </select>

        <!-- ë³´í›ˆ -->
        <div id="veteranFields" class="pref-fields" style="display:none;">
          <select name="v_type" class="text_input">
            <option>êµ­ê°€ìœ ê³µì</option><option>ë³´í›ˆëŒ€ìƒì</option>
          </select>
          <input name="v_cert" type="text" placeholder="ì¦ëª…ì„œ ë²ˆí˜¸" class="text_input">
        </div>

        <!-- ë³‘ì—­ -->
        <div id="militaryFields" class="pref-fields" style="display:none;">
          <select name="m_status" id="mStatus" class="text_input" onchange="toggleMilitaryDetail()">
            <option value="">ë³‘ì—­êµ¬ë¶„</option>
            <option value="served">êµ°í•„</option>
            <option value="exempt">ë©´ì œ</option>
            <option value="unserved">ë¯¸í•„</option>
          </select>

          <div id="servedDetail" style="display:none;">
            <input  name="m_start" type="month" class="text_input" placeholder="ì…ëŒ€ YYYY-MM" min="1950-01" max="2100-12">
            <input  name="m_end"   type="month" class="text_input" placeholder="ì „ì—­ YYYY-MM" min="1950-01" max="2100-12">
            <select name="m_branch" class="text_input">
              <option>ìœ¡êµ°</option><option>í•´êµ°</option><option>ê³µêµ°</option>
              <option>í•´ë³‘</option><option>ì˜ê²½</option><option>ì‚¬íšŒë³µë¬´ìš”ì›</option>
            </select>
            <select name="m_rank" class="text_input">
              <option>ì´ë³‘</option><option>ì¼ë³‘</option><option>ìƒë³‘</option><option>ë³‘ì¥</option>
              <option>í•˜ì‚¬</option><option>ì¤‘ì‚¬</option><option>ìƒì‚¬</option><option>ì›ì‚¬</option>
              <option>ì¤€ìœ„</option><option>ì†Œìœ„</option><option>ì¤‘ìœ„</option><option>ëŒ€ìœ„</option>
              <option>ì†Œë ¹</option><option>ì¤‘ë ¹</option><option>ëŒ€ë ¹</option>
              <option>ì¤€ì¥</option><option>ì†Œì¥</option><option>ì¤‘ì¥</option><option>ëŒ€ì¥</option>
            </select>
            <select name="m_reason" class="text_input">
              <option>ë§Œê¸°ì „ì—­</option><option>ì˜ê°€ì‚¬ì „ì—­</option><option>ì˜ë³‘ì „ì—­</option>
              <option>ì†Œì§‘í•´ì œ</option><option>ë¶ˆëª…ì˜ˆì „ì—­</option><option>ìƒì´ì „ì—­</option>
            </select>
          </div>
        </div>

        <!-- ê³ ìš©ì§€ì›ê¸ˆ -->
        <div id="employmentFields" class="pref-fields" style="display:none;">
          <select name="e_type" class="text_input">
            <option>ì²­ë…„ê³ ìš©ì§€ì›ê¸ˆ</option><option>ì¥ì• ì¸ê³ ìš©ì§€ì›ê¸ˆ</option>
          </select>
        </div>

        <div class="form-buttons">
          <button onclick="cancelPreference()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savePreference()"   class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!-- í¬íŠ¸í´ë¦¬ì˜¤ -->
    <div class="section" id="portfolio-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">í¬íŠ¸í´ë¦¬ì˜¤</div>
        <button class="addbtn" onclick="showPortfolioForm()">+ì¶”ê°€</button>
      </div>
      <div id="portfolio-list"></div>
    </div>

    <!-- í¬íŠ¸í´ë¦¬ì˜¤ í…œí”Œë¦¿ -->
    <div id="portfolio-form-template" style="display: none;">
      <div class="portfolio-entry">
        <div class="portfolio-summary" style="display: none;"></div>

        <input type="text" placeholder="í”„ë¡œì íŠ¸ëª…" class="text_input"><br>
        <textarea placeholder="í”„ë¡œì íŠ¸ ì„¤ëª…" class="longtext"></textarea>
        <input type="file" multiple class="text_input file-input">

        <div class="form-buttons">
          <button onclick="removePortfolioForm(this)" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savePortfolio(this)" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>

    <!--ê²½ë ¥ê¸°ìˆ ì„œ-->
    <div class="section" id="description-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ê²½ë ¥ê¸°ìˆ ì„œ</div>
        <button class="addbtn" onclick="showdescription()">+ì¶”ê°€</button>
      </div>

      <div id="career-description-list"></div>

      <!-- ì…ë ¥ í¼ -->
      <div id="career-description-form" style="display: none;">
        <textarea id="careerDescriptionText" class="longtext" placeholder="ê²½ë ¥ê¸°ìˆ ì„œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
          oninput="updateCharCount()" style="width: 100%; height: 200px; font-size: 16px;"></textarea>
          
        <div style="margin-top: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <button class="type-tab" onclick="insertTemplate('project')">í”„ë¡œì íŠ¸í˜•</button>
            <button class="type-tab" onclick="insertTemplate('dev')">ê°œë°œ ê¸°ìˆ í˜•</button>
            <button class="type-tab" onclick="insertTemplate('design')">ë””ìì´ë„ˆí˜•</button>
            <button class="type-tab" onclick="insertTemplate('sales')">ì˜ì—… ì„±ê³¼í˜•</button>
          </div>
          <div style="color: #999; font-size: 14px;">
            ì´ ê¸€ììˆ˜ <span id="totalChars">0</span>ì / <span id="totalBytes">0</span> byte
          </div>
        </div>

        <div style="margin-top: 10px; text-align: right;">
          <button onclick="canceldescription()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="savedescription()" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>


    <!-- ìê¸°ì†Œê°œì„œ -->
    <div class="section" id="introduction-section" style="display: none;">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="section-title">ìê¸°ì†Œê°œì„œ</div>
      <button class="addbtn" onclick="showIntroductionForm()">+ì¶”ê°€</button>
      </div>

      <!-- ì €ì¥ëœ ìê¸°ì†Œê°œì„œ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
      <div id="introduction-list"></div>

      <!-- ì…ë ¥ í¼ -->
      <div id="introduction-form" style="display: none; margin-top: 15px;">
        <input type="text" id="introTitle" placeholder="ìê¸°ì†Œê°œì„œ ì œëª©" class="text_input" style="width: 100%; margin-bottom: 10px;">

        <textarea id="introTextarea" placeholder="ìê¸°ì†Œê°œì„œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="updateIntroCount()" style="width: 100%; height: 200px; font-size: 16px;"></textarea>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
          <div class="intro-tools">
            <button type="button" onclick="checkSpelling()" class="cencle_save_btn tool-btn">
              ë§ì¶¤ë²•&nbsp;ê²€ì‚¬
            </button>
            <button type="button" onclick="runAIReview()" class="cencle_save_btn tool-btn">
              AI&nbsp;ì²¨ì‚­
            </button>
        </div>
          <div style="color: #999; font-size: 14px;">
            ì´ ê¸€ììˆ˜ <span id="introChars">0</span>ì / <span id="introBytes">0</span> byte
        </div>
        </div>


        <div class="form-buttons">

          <button onclick="cancelIntroductionForm()" class="cencle_save_btn">ì·¨ì†Œ</button>
          <button onclick="saveIntroductionForm()" class="cencle_save_btn">ì €ì¥</button>
        </div>
      </div>
    </div>


    {% comment %} my career {% endcomment %}
    <div class="right-panel">
      <div class="right-panel-move">
        <div class="right-panel-title">
          <strong>My Career</strong>
        </div>
        <div class="checkbox-group">
          <div class="checkboxtext">
            <span>í•™ë ¥</span>
            <input type="checkbox" id="section-education" onchange="toggleSection('education-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½ë ¥</span>
            <input type="checkbox" id="section-career" onchange="toggleSection('career-section')">
          </div>
          <div class="checkboxtext">
            <span>ìŠ¤í‚¬</span>
            <input type="checkbox" id="section-skill" onchange="toggleSection('skill-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½í—˜/í™œë™/êµìœ¡</span>
            <input type="checkbox" id="section-experience" onchange="toggleSection('experience-section')">
          </div>
          <div class="checkboxtext">
            <span>ìê²©/ì–´í•™/ìˆ˜ìƒ</span>
            <input type="checkbox" id="section-certificate" onchange="toggleSection('certificate-section')">
          </div>
          <div class="checkboxtext">
            <span>ì·¨ì—…ìš°ëŒ€ì‚¬í•­</span>
            <input type="checkbox" id="section-preference" onchange="toggleSection('preference-section')">
          </div>
          <div class="checkboxtext">
            <span>í¬íŠ¸í´ë¦¬ì˜¤</span>
            <input type="checkbox" id="section-portfolio" onchange="toggleSection('portfolio-section')">
          </div>
          <div class="checkboxtext">
            <span>ê²½ë ¥ê¸°ìˆ ì„œ</span>
            <input type="checkbox" id="section-description" onchange="toggleSection('description-section')">
          </div>
          <div class="checkboxtext">
            <span>ìê¸°ì†Œê°œì„œ</span>
            <input type="checkbox" id="section-introduction" onchange="toggleSection('introduction-section')">
          </div>
        </div>

        <button class="endbtn" onclick="previewResume()">ì´ë ¥ì„œ ë¯¸ë¦¬ë³´ê¸°</button>

        <input type="hidden" id="sections-json">
        <button class="endbtn" onclick="saveResume(event)">ì‘ì„±ì™„ë£Œ</button>

      </div>
    </div>


    <script>
      let selectedResumeId = null;

      const loggedInUserId = "{{ request.user.username }}";
      
      // ê¸°ë³¸ì •ë³´ ìë™ ì±„ìš°ê¸°ìš© ë°ì´í„°
      const defaultInfo = {{ default_info|safe }};

       // ì‚¬ìš©í•  ìŠ¤í‚¬ ëª©ë¡
      const availableSkills = [
      "Python", "Java", "C", "C++", "C#", "JavaScript", "TypeScript", "Go", "Kotlin", "Swift", "Ruby", "PHP", "Rust", "Scala",
      "HTML", "CSS", "React", "Vue.js", "Angular", "Next.js", "Svelte", "Tailwind CSS", "Bootstrap", "jQuery",
      "Django", "Flask", "Spring", "Spring Boot", "Node.js", "Express", "FastAPI", "NestJS", "Ruby on Rails", "ASP.NET",
      "MySQL", "PostgreSQL", "SQLite", "MongoDB", "Firebase", "Oracle", "AWS", "Azure", "Google Cloud", "Docker", "Kubernetes",
      "Git", "GitHub", "Linux", "VS Code", "Jenkins", "Notion", "Figma", "TensorFlow", "PyTorch", "OpenCV", "Unity", "Unreal Engine"
      ];


      // ì„ íƒëœ ìŠ¤í‚¬ ì €ì¥ ë°°ì—´
      let selectedSkills = [];

      function getSectionCheckboxStates() {
        return {
          education: document.getElementById('section-education').checked,
          career: document.getElementById('section-career').checked,
          skill: document.getElementById('section-skill').checked,
          experience: document.getElementById('section-experience').checked,
          certificate: document.getElementById('section-certificate').checked,
          preference: document.getElementById('section-preference').checked,
          portfolio: document.getElementById('section-portfolio').checked,
          description: document.getElementById('section-description').checked,
          introduction: document.getElementById('section-introduction').checked
        }
      }

      // ìê¸°ì†Œê°œì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” í•¨ìˆ˜ (ì´ì œ saveResume ìœ„ì— ìœ„ì¹˜)
      function collectIntroductionData() {
        // ... í•¨ìˆ˜ ë‚´ìš© ...
      }

      function saveResume() {
        const title = document.getElementById('resume-title').value;
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const birthdate = document.getElementById('birthdate').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const detailAddress = document.getElementById('detail-address').value;

        // sections ê°ì²´ ì •ì˜
        const sections = {
          education: collectEducationData() || [],
          career: collectCareerData() || [],
          experience: collectExperienceData() || [],
          certificate: collectCertificateData() || [],
          preference: collectPreferenceData() || [],
          portfolio: collectPortfolioData() || [],
          description: collectCareerDescriptionData() || [],
          introduction: collectIntroductionData() || [],
          skills: selectedSkills || [],
          sectionCheckboxStates: getSectionCheckboxStates()
        };

        const formData = new FormData();
        formData.append('title', title);
        formData.append('name', name);
        formData.append('gender', gender);
        formData.append('birthdate', birthdate);
        formData.append('email', email);
        formData.append('phone', phone);
        formData.append('address', address);
        formData.append('detail-address', detailAddress);
        formData.append('sections_json', JSON.stringify(sections));

        // í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì¶”ê°€
        const profileImageFile = document.getElementById('profile-image-input').files[0];
        if (profileImageFile) {
          formData.append('profile_image', profileImageFile);
        }

        fetch('/save_resume/', {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: formData
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            alert("ì €ì¥ ì‹¤íŒ¨");
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });


    }



      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }




      function addToResumeList(title) {
        const listDiv = document.querySelector('.resume-list');
        const newItem = document.createElement('div');
        newItem.textContent = title;
        newItem.onclick = () => loadResume(title);
        listDiv.appendChild(newItem);
      }

      function loadResume(title) {
        const resumes = JSON.parse(localStorage.getItem('resumeList')) || [];
        const resume = resumes.find(r => r.basicInfo.title === title);
        if (!resume) return;

        document.getElementById('resume-title').value = resume.basicInfo.title;
        document.getElementById('name').value = resume.basicInfo.name;
        document.getElementById('gender').value = resume.basicInfo.gender;
        document.getElementById('birthdate').value = resume.basicInfo.birthdate;
        document.getElementById('email').value = resume.basicInfo.email;
        document.getElementById('phone').value = resume.basicInfo.phone;
        document.getElementById('address').value = resume.basicInfo.address;
        document.getElementById('detail-address').value = resume.basicInfo.detailAddress;

      selectedSkills = resume.skills;

      // ë§Œì•½ ë°°ì—´ì´ ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ ê°•ì œ
      if (!Array.isArray(selectedSkills)) {
        if (typeof selectedSkills === 'string') {
          try {
            selectedSkills = JSON.parse(selectedSkills);
            if (!Array.isArray(selectedSkills)) selectedSkills = [];
          } catch (e) {
            selectedSkills = [];
          }
        } else {
          selectedSkills = [];
        }
      }

        updateSkillList();

      }

    function loadResumeFromServer(resumeId) {
      selectedResumeId = resumeId;
      fetch(`/get_resume/${resumeId}/`)
        .then(response => {
          if (!response.ok) throw new Error('ì´ë ¥ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
          return response.json();
        })
        .then(data => {
          const resume = data.content;
          if (!resume) {
            alert("ì´ë ¥ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          // ê¸°ë³¸ ì •ë³´
          document.getElementById('resume-title').value = data.title || '';
          document.getElementById('name').value = resume.name || '';
          document.getElementById('gender').value = resume.gender || '';
          document.getElementById('birthdate').value = resume.birthdate || '';
          document.getElementById('email').value = resume.email || '';
          document.getElementById('phone').value = resume.phone || '';
          document.getElementById('address').value = resume.address || '';
          document.getElementById('detail-address').value = resume.detail_address || '';

          // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ë“¤ ëª¨ë‘ ì´ˆê¸°í™”
          document.getElementById('education-list').innerHTML = '';
          document.getElementById('career-list').innerHTML = '';
          document.getElementById('experience-list').innerHTML = '';
          document.getElementById('skill-list').innerHTML = '';
          document.getElementById('certificate-list').innerHTML = '';
          document.getElementById('preference-list').innerHTML = '';
          document.getElementById('portfolio-list').innerHTML = '';
          document.getElementById('career-description-list').innerHTML = '';
          document.getElementById('introduction-list').innerHTML = '';

          // 1. í•™ë ¥
          if (resume.sections && Array.isArray(resume.sections.education)) {
            resume.sections.education.forEach(edu => {
              const list = document.getElementById('education-list');
              const entry = document.createElement('div');
              entry.className = 'education-entry';
              entry.innerHTML = `
                <div class="education-summary" style="display:block;">
                  <div class="education-card">
                    <h4>${edu.school || ''} (${edu.startDate || edu['ì…í•™ë…„ë„'] || ''} ~ ${edu.endDate || edu['ì¡¸ì—…ë…„ë„'] || ''})</h4>
                    <p><strong>ì „ê³µ:</strong> ${edu.major || edu['ì „ê³µ'] || ''}</p>
                    <p><strong>í•™ì :</strong> ${edu.grade || edu['í•™ì '] || ''}</p>
                    <p><strong>ì¡¸ì—… êµ¬ë¶„:</strong> ${edu.graduation || edu['ì¡¸ì—…êµ¬ë¶„'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 2. ê²½ë ¥
          if (resume.sections && Array.isArray(resume.sections.career)) {
            resume.sections.career.forEach(career => {
              const list = document.getElementById('career-list');
              const entry = document.createElement('div');
              entry.className = 'career-entry';
              entry.innerHTML = `
                <div class="career-summary" style="display:block;">
                  <div class="career-card">
                    <h4>${career.company || ''} (${career.startDate || career['ì…ì‚¬ë…„ì›”'] || ''} ~ ${career.endDate || career['í‡´ì‚¬ë…„ì›”'] || ''})</h4>
                    <p><strong>ì§ë¬´:</strong> ${career.position || career['ì§ë¬´'] || ''}</p>
                    <p><strong>ê·¼ë¬´ë¶€ì„œ:</strong> ${career.department || career['ê·¼ë¬´ë¶€ì„œ'] || ''}</p>
                    <p><strong>ì§ê¸‰:</strong> ${career.rank || career['ì§ê¸‰'] || ''}</p>
                    <p><strong>ë‹´ë‹¹ì—…ë¬´:</strong> ${career.duties || career['ë‹´ë‹¹ì—…ë¬´'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 3. ê²½í—˜/í™œë™/êµìœ¡
          if (resume.sections && Array.isArray(resume.sections.experience)) {
            resume.sections.experience.forEach(exp => {
              const list = document.getElementById('experience-list');
              const entry = document.createElement('div');
              entry.className = 'experience-entry';
              entry.innerHTML = `
                <div class="experience-summary" style="display:block;">
                  <div class="experience-card">
                    <h4>${exp.activityType || exp['í™œë™ ìœ í˜•'] || ''} - ${exp.place || exp['ê¸°ê´€/ì¥ì†Œëª…'] || ''} 
                      (${exp.startDate || exp['ì‹œì‘ë…„ì›”'] || ''} ~ ${exp.endDate || exp['ì¢…ë£Œë…„ì›”'] || ''})</h4>
                    <p><strong>í™œë™ ì„¤ëª…:</strong> ${exp.description || exp['í™œë™ ì„¤ëª…'] || ''}</p>
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 4. ìŠ¤í‚¬
          selectedSkills = (resume.sections && Array.isArray(resume.sections.skills)) ? resume.sections.skills : [];
          updateSkillList();

          // 5. ìê²©/ì–´í•™/ìˆ˜ìƒ
          if (resume.sections && Array.isArray(resume.sections.certificate)) {
            const list = document.getElementById('certificate-list');
            resume.sections.certificate.forEach(cert => {
              const card = document.createElement('div');
              card.className = 'cert-card';

              let detail = '';
              if (cert.type === 'license' || cert.type === 'ìê²©ì¦') {
                detail = `<strong>[ìê²©ì¦]</strong> ${cert.license_name || cert['ìê²©ì¦ëª…'] || ''} Â· ${cert.issuer || cert['ë°œí–‰ì²˜'] || ''} (${cert.pass_date || cert['í•©ê²©ë…„ì›”'] || ''})`;
              } else if (cert.type === 'language' || cert.type === 'ì–´í•™') {
                detail = `<strong>[ì–´í•™]</strong> ${cert.lang || cert['ì–¸ì–´'] || ''} ${cert.exam || cert['ì–´í•™ì‹œí—˜ëª…'] || ''} ${cert.score || cert['ê¸‰ìˆ˜/ì ìˆ˜'] || ''} (${cert.status || cert['ì·¨ë“ìƒíƒœ'] || ''})`;
              } else if (cert.type === 'award' || cert.type === 'ìˆ˜ìƒ') {
                detail = `<strong>[ìˆ˜ìƒ]</strong> ${cert.award_name || cert['ìˆ˜ìƒ/ê³µëª¨ì „ëª…'] || ''} Â· ${cert.host || cert['ìˆ˜ì—¬/ì£¼ìµœê¸°ê´€'] || ''} (${cert.award_date || cert['ìˆ˜ìƒì¼'] || ''})`;
              }
              card.innerHTML = `<span>${detail}</span>`;
              list.appendChild(card);
            });
          }

          // 6. ì·¨ì—…ìš°ëŒ€ì‚¬í•­
          if (resume.sections && resume.sections.preference) {
            const list = document.getElementById('preference-list');
            const prefData = resume.sections.preference;

            // ê°ì²´ì¸ ê²½ìš° ë°°ì—´ë¡œ ê°ì‹¸ê¸°
            const preferences = Array.isArray(prefData) ? prefData : [prefData];

            preferences.forEach(pref => {
              console.log("preference item:", pref); 
              const card = document.createElement('div');
              card.className = 'pref-card';
              let detail = '';

              if (pref.type === 'veteran' || pref.type === 'ë³´í›ˆëŒ€ìƒ') {
                detail = `[ë³´í›ˆ] ${pref.v_type || pref['ë³´í›ˆêµ¬ë¶„'] || ''} (ì¦ì„œ: ${pref.v_cert || pref['ì¦ëª…ì„œ ë²ˆí˜¸'] || ''})`;

              } else if (pref.type === 'military' || pref.type === 'ë³‘ì—­ëŒ€ìƒ') {
                const statusMap = {
                  'served': 'êµ°í•„',
                  'exempt': 'ë©´ì œ',
                  'unserved': 'ë¯¸í•„'
                };

                if (pref.m_status === 'served' || pref.m_status === 'êµ°í•„') {
                  detail = `[êµ°í•„] ${pref.m_branch || ''}Â·${pref.m_rank || ''} (${pref.m_start || ''}~${pref.m_end || ''}) / ${pref.m_reason || ''}`;
                } else {
                  detail = `[ë³‘ì—­] ${statusMap[pref.m_status] || pref.m_status || ''}`;
                }
              } else if (pref.type === 'military' || pref.type === 'ë³‘ì—­ëŒ€ìƒ') {
                detail = `[ë³‘ì—­] ${pref.m_status || ''}`;

              } else if (pref.type === 'employment' || pref.type === 'ê³ ìš©ì§€ì›ê¸ˆ') {
                detail = `[ì§€ì›ê¸ˆ] ${pref.e_type || ''}`;
              }

              if (detail) {
                card.innerHTML = `<span>${detail}</span>`;
                list.appendChild(card);
              }
            });
          }



          // 7. í¬íŠ¸í´ë¦¬ì˜¤
          if (resume.sections && Array.isArray(resume.sections.portfolio)) {
            const list = document.getElementById('portfolio-list');
            resume.sections.portfolio.forEach(port => {
              const entry = document.createElement('div');
              entry.className = 'portfolio-entry';
              let files = '';
              if (port.files && typeof port.files === 'string') files = port.files;
              if (Array.isArray(port.files)) files = port.files.join(', ');
              entry.innerHTML = `
                <div class="portfolio-summary" style="display:block;">
                  <div class="portfolio-card">
                    <h4>${port.project || port['í”„ë¡œì íŠ¸ëª…'] || ''}</h4>
                    <p><strong>ì„¤ëª…:</strong> ${port.description || port['í”„ë¡œì íŠ¸ ì„¤ëª…'] || ''}</p>
                    ${files ? `<p><strong>ì²¨ë¶€íŒŒì¼:</strong> ${files}</p>` : ''}
                  </div>
                </div>
              `;
              list.appendChild(entry);
            });
          }

          // 8. ê²½ë ¥ê¸°ìˆ ì„œ
          if (resume.sections && Array.isArray(resume.sections.description)) {
            const list = document.getElementById('career-description-list');
            resume.sections.description.forEach(desc => {
              const entry = document.createElement('div');
              entry.className = 'career-desc-card';
              entry.style.padding = "10px";
              entry.style.marginTop = "10px";
              entry.style.position = "relative";
              entry.innerHTML = `
                <div style="white-space: pre-wrap;">${desc.content || desc['ë‚´ìš©'] || ''}</div>
              `;
              list.appendChild(entry);
            });
          }

          // 9. ìê¸°ì†Œê°œì„œ (ì—¬ëŸ¬ê°œ ì €ì¥í•  ìˆ˜ ìˆê²Œ)
          if (resume.sections && Array.isArray(resume.sections.introduction)) {
            const list = document.getElementById('introduction-list');
            resume.sections.introduction.forEach(intro => {
              const entry = document.createElement('div');
              entry.className = 'introduction-card';
              entry.style.borderBottom = "1px solid #ddd";
              entry.style.padding = "10px";
              entry.style.marginTop = "10px";
              entry.style.position = "relative";
              entry.innerHTML = `
                <h4>${intro.title || intro['ì œëª©'] || ''}</h4>
                <div style="white-space: pre-wrap;">${intro.content || intro['ë‚´ìš©'] || ''}</div>
              `;
              list.appendChild(entry);
            });
          }

          // 10. ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³µì› ë° ì„¹ì…˜ ì—´ê¸°
          if (resume.sections && resume.sections.sectionCheckboxStates) {
            const cb = resume.sections.sectionCheckboxStates;
            Object.keys(cb).forEach(key => {
              const checked = !!cb[key];
              const checkbox = document.getElementById(`section-${key}`);
              const section = document.getElementById(`${key}-section`);

              console.log(`checkbox id: section-${key}`, checkbox, "checked:", checked);
              
              if (checkbox) checkbox.checked = checked;
              if (section) section.style.display = checked ? 'block' : 'none';
            });
          }

          //ì´ë¯¸ì§€ì§€
          if (data.profile_image_url) {
            const previewDiv = document.getElementById("profile-image-preview");
            previewDiv.style.backgroundImage = `url('${data.profile_image_url}')`;
            document.getElementById("upload-plus").style.display = 'none';
          }

        })
        .catch(error => {
          alert('ì´ë ¥ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
        });


    }







    function deleteResume(resumeId) {
      if (!confirm("ì •ë§ ì´ ì´ë ¥ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

      fetch(`/resume/delete/${resumeId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert("ì´ë ¥ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          location.reload();
        } else {
          alert("ì‚­ì œ ì‹¤íŒ¨");
        }
      })
      .catch(error => {
        console.error("ì‚­ì œ ì˜¤ë¥˜:", error);
        alert("ì˜¤ë¥˜ ë°œìƒ");
      });
    }






      // ê° ì„¹ì…˜ë³„ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜ë“¤
      function collectEducationData() {
        const summaries = document.querySelectorAll('.education-summary');

        return Array.from(summaries).map(summary => {
          const card = summary.querySelector('.education-card');
          if (!card) return null;

          const schoolText = card.querySelector('h4')?.textContent || '';
          const majorText = card.querySelector('p:nth-child(2)')?.textContent.replace('ì „ê³µ:', '').trim() || '';
          const gradeText = card.querySelector('p:nth-child(3)')?.textContent.replace('í•™ì :', '').trim() || '';
          const graduationText = card.querySelector('p:nth-child(4)')?.textContent.split('ì‚­ì œ')[0].replace('ì¡¸ì—… êµ¬ë¶„:', '').trim() || '';

          return {
            school: schoolText,
            major: majorText,
            grade: gradeText,
            graduation: graduationText
          };
        }).filter(item => item !== null);
      }

      //ê²½ë ¥
      function collectCareerData() {
        const careerEntries = document.querySelectorAll('.career-card');
        return Array.from(careerEntries).map(entry => {
          const companyText = entry.querySelector('h4').textContent;
          const positionText = entry.querySelector('p:nth-child(2)').textContent.replace('ì§ë¬´:', '').trim();
          const departmentText = entry.querySelector('p:nth-child(3)').textContent.replace('ê·¼ë¬´ë¶€ì„œ:', '').trim();
          const rankText = entry.querySelector('p:nth-child(4)').textContent.replace('ì§ê¸‰:', '').trim();
          const dutiesText = entry.querySelector('p:nth-child(5)').textContent.replace('ë‹´ë‹¹ì—…ë¬´:', '').trim();

          // íšŒì‚¬ëª…ê³¼ ê¸°ê°„ ë¶„ë¦¬
          const [company, period] = companyText.split(' (');
          const [startDate, endDate] = period.replace(')', '').split(' ~ ');

          return {
            company: company.trim(),
            startDate: startDate.trim(),
            endDate: endDate.trim(),
            position: positionText,
            department: departmentText,
            rank: rankText,
            duties: dutiesText
          };
        });
      }
      //ê²½í—˜/í™œë™/êµìœ¡
      function collectExperienceData() {
        const experienceEntries = document.querySelectorAll('.experience-card');
        return Array.from(experienceEntries).map(entry => {
          const activityText = entry.querySelector('h4').textContent;
          const descriptionText = entry.querySelector('p:nth-child(2)').textContent.replace('í™œë™ ì„¤ëª…:', '').trim();

          // í™œë™ ìœ í˜•, ê¸°ê´€/ì¥ì†Œëª…, ê¸°ê°„ ë¶„ë¦¬
          const [activityType, placeAndPeriod] = activityText.split(' - ');
          const [place, period] = placeAndPeriod.split(' (');
          const [startDate, endDate] = period.replace(')', '').split(' ~ ');

          return {
            activityType: activityType.trim(),
            place: place.trim(),
            startDate: startDate.trim(),
            endDate: endDate.trim(),
            description: descriptionText
          };
        });
      }
      //ìê²©/ì–´í•™/ìˆ˜ìƒ
      function collectCertificateData() {
        const certificateEntries = document.querySelectorAll('.cert-card');
        return Array.from(certificateEntries).map(entry => {
          const detailText = entry.querySelector('span').textContent;
          
          // ìê²©ì¦, ì–´í•™, ìˆ˜ìƒ êµ¬ë¶„
          if (detailText.includes('[ìê²©ì¦]')) {
            const [_, info] = detailText.split('[ìê²©ì¦]');
            const [name, issuerAndDate] = info.split('Â·');
            const [issuer, date] = issuerAndDate.split('(');
            
            return {
              type: 'license',
              license_name: name.trim(),
              issuer: issuer.trim(),
              pass_date: date.replace(')', '').trim()
            };
          } else if (detailText.includes('[ì–´í•™]')) {
            const [_, info] = detailText.split('[ì–´í•™]');
            const [lang, exam, score, status] = info.split(' ');
            
            return {
              type: 'language',
              lang: lang.trim(),
              exam: exam.trim(),
              score: score.trim(),
              status: status.replace('(', '').replace(')', '').trim()
            };
          } else {
            const [_, info] = detailText.split('[ìˆ˜ìƒ]');
            const [name, hostAndDate] = info.split('Â·');
            const [host, date] = hostAndDate.split('(');
            
            return {
              type: 'award',
              award_name: name.trim(),
              host: host.trim(),
              award_date: date.replace(')', '').trim()
            };
          }
        });
      }
      //ì·¨ì—…ìš°ëŒ€ì‚¬í•­
      function collectPreferenceData() {
        return preferenceData;  // â† ì „ì—­ ë°°ì—´ preferenceDataë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜
      }

      //í¬íŠ¸í´ë¦¬ì˜¤
      function collectPortfolioData() {
        const portfolioEntries = document.querySelectorAll('.portfolio-card');
        return Array.from(portfolioEntries).map(entry => {
          const projectName = entry.querySelector('h4').textContent;
          const description = entry.querySelector('p:nth-child(2)').textContent.replace('ì„¤ëª…:', '').trim();
          const filesText = entry.querySelector('p:nth-child(3)')?.textContent;
          const files = filesText ? filesText.replace('ì²¨ë¶€íŒŒì¼:', '').trim() : '';
          
          // localStorageì— ì €ì¥
          const portfolioData = {
            project: projectName,
            description: description,
            files: files
          };
          
          // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          let savedPortfolios = JSON.parse(localStorage.getItem('portfolios') || '[]');
          savedPortfolios.push(portfolioData);
          localStorage.setItem('portfolios', JSON.stringify(savedPortfolios));
          
          return portfolioData;
        });
      }
      //ê²½ë ¥ê¸°ìˆ ì„œ
      function collectCareerDescriptionData() {
        const descriptionCards = document.querySelectorAll('.career-desc-card');
        const descriptions = Array.from(descriptionCards).map(card => {
          const content = card.querySelector('div').innerText;
          
          // localStorageì— ì €ì¥
          const descriptionData = {
            content: content
          };
          
          // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          let savedDescriptions = JSON.parse(localStorage.getItem('careerDescriptions') || '[]');
          savedDescriptions.push(descriptionData);
          localStorage.setItem('careerDescriptions', JSON.stringify(savedDescriptions));
          
          return descriptionData;
        });
        
        return descriptions;
      }


      // ì¶”ê°€ ë²„íŠ¼ ëˆ„ë¥´ë©´ ê²€ìƒ‰ì°½ ë³´ì´ê¸°
      function showskill() {
        document.getElementById("skill-form").style.display = "block";
        document.getElementById("skillSearch").value = "";
        document.getElementById("skillSuggestions").innerHTML = "";
        document.getElementById("skillSuggestions").style.display = "none";
      }

      // ì·¨ì†Œ ë²„íŠ¼ ëˆ„ë¥´ë©´ ê²€ìƒ‰ì°½ ìˆ¨ê¸°ê¸°
      function cancelskill() {
        document.getElementById("skill-form").style.display = "none";
        document.getElementById("skillSearch").value = "";
        document.getElementById("skillSuggestions").innerHTML = "";
        document.getElementById("skillSuggestions").style.display = "none";
      }

      // ì €ì¥ ë²„íŠ¼ ëˆ„ë¥´ë©´ ì„ íƒëœ ìŠ¤í‚¬ í™”ë©´ì— ì¶œë ¥
      function saveskill() {
      updateSkillList();
      document.getElementById("skill-form").style.display = "none";
      }


      // ìë™ì™„ì„± ê²€ìƒ‰
      function searchSkills() {
      const input = document.getElementById("skillSearch").value.toLowerCase();
      const suggestionsBox = document.getElementById("skillSuggestions");
      suggestionsBox.innerHTML = "";

      if (!input) {
        suggestionsBox.style.display = "none";
        return;
      }

      const matches = availableSkills.filter(skill =>
        skill.toLowerCase().includes(input) && !selectedSkills.includes(skill)
      );

      if (matches.length === 0) {
        suggestionsBox.style.display = "none";
        return;
      }

      suggestionsBox.style.display = "block";
      matches.forEach(skill => {
        const div = document.createElement("div");
        div.textContent = skill;
        div.style.padding = "5px";
        div.style.cursor = "pointer";
        div.style.borderBottom = "1px solid #eee";

        div.onclick = () => {
          selectedSkills.push(skill);
          document.getElementById("skillSearch").value = "";
          suggestionsBox.style.display = "none";

          // âœ… ë¦¬ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
          const list = document.getElementById("skill-list");
          updateSkillList();
          searchSkills(); // ì¤‘ë³µ ì œê±°ìš©

        };

        suggestionsBox.appendChild(div);
      });
    }

    function updateSkillList() {
      const list = document.getElementById("skill-list");
      list.innerHTML = "";

      if (!Array.isArray(selectedSkills)) {
        try {
          selectedSkills = JSON.parse(selectedSkills);
          if (!Array.isArray(selectedSkills)) selectedSkills = [];
        } catch (e) {
          selectedSkills = [];
        }
      }

      selectedSkills.forEach((skill, index) => {
        const span = document.createElement("span");
        span.className = "skill-tag";
        span.style.position = "relative";
        span.style.display = "inline-block";
        span.style.marginRight = "10px";
        span.style.padding = "6px 24px 6px 10px";
        span.style.border = "3px solid #F5D1EA";
        span.style.borderRadius = "5px";
        span.style.backgroundColor = "none";
        span.style.cursor = "default";

        const skillText = document.createTextNode(`âœ” ${skill}`);
        span.appendChild(skillText);

        const closeBtn = document.createElement("span");  // âœ… ì„ ì–¸ ë¨¼ì €!
        closeBtn.className = "delete-btn";
        closeBtn.textContent = "Ã—";
        closeBtn.style.position = "absolute";
        closeBtn.style.right = "4px";
        closeBtn.style.top = "4px";
        closeBtn.style.fontSize = "14px";
        closeBtn.style.cursor = "pointer";
        closeBtn.style.color = "#ff4d4d";
        closeBtn.style.backgroundColor = "#fff";
        closeBtn.style.padding = "0 4px";
        closeBtn.style.borderRadius = "50%";
        closeBtn.style.border = "1px solid #ccc";
        closeBtn.style.display = "none"; // â— ì„ ì–¸ ì´í›„ì— display ì¡°ì‘

        // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ë³´ì´ê¸°
        span.addEventListener("mouseenter", () => {
          closeBtn.style.display = "inline";
        });
        span.addEventListener("mouseleave", () => {
          closeBtn.style.display = "none";
        });

        closeBtn.onclick = () => {
          selectedSkills.splice(index, 1);
          updateSkillList();
        };

        span.appendChild(closeBtn);
        list.appendChild(span);
      });
    }







      //í† ê¸€ 
      function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        section.style.display = section.style.display === 'none' ? 'block' : 'none';
      }

      
      //í•™ë ¥ ì¶”ê°€
      function showEducationForm() {

        const list = document.getElementById('education-list');

        // ì…ë ¥ë€ì´ ë³´ì´ëŠ” ìƒíƒœ = ì•„ì§ ì €ì¥ë˜ì§€ ì•Šì€ í¼ì´ ì—´ë ¤ìˆë‹¤ëŠ” ëœ»
        const isFormOpen = Array.from(list.querySelectorAll('.education-entry')).some(entry => {
          const inputs = entry.querySelectorAll('input, textarea');
          return Array.from(inputs).some(input => input.style.display !== 'none');
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById("education-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = 'block';
        list.appendChild(clone);
      }
      //í•™ë ¥ ì‚­ì œ
      function removeEducationForm(button) {
        const entry = button.closest(".education-entry");
        if (entry) {
          entry.remove();
        }
      }
      // í•™ë ¥ ìˆ˜ì •í•˜ê¸°
      function editEducation(button) {
        const entry = button.closest(".education-entry");
        const summary = entry.querySelector(".education-summary");
        const inputs = entry.querySelectorAll("input, select");
        const formButtons = entry.querySelector(".form-buttons");

        // ìš”ì•½ ì¹´ë“œ ìˆ¨ê¸°ê¸°
        summary.style.display = "none";

        // ì…ë ¥ í•„ë“œ ë‹¤ì‹œ ë³´ì´ê²Œ
        inputs.forEach(input => input.style.display = "inline-block");

        // ê¸°ì¡´ card-buttons ì œê±°
        const cardButtons = summary.querySelector(".card-buttons");
        if (cardButtons) {
          cardButtons.remove();
        }

        // ì €ì¥/ì‚­ì œ ë²„íŠ¼ ë‹¤ì‹œ ìƒì„±
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }
      //í•™ë ¥ ì €ì¥ 
      function saveEducation(button) {
        const entry = button.closest(".education-entry");
        const summary = entry.querySelector(".education-summary");
        const inputs = entry.querySelectorAll("input, select");
        const formButtons = entry.querySelector(".form-buttons");

        let values = {};

        inputs.forEach(input => {
          if (input.tagName.toLowerCase() === "select") {
            values["ì¡¸ì—…êµ¬ë¶„"] = input.options[input.selectedIndex].text;
          } else {
            const key = input.placeholder || 'ì„ íƒ';
            values[key] = input.value.trim();
          }
        });

        // ë‚ ì§œ í˜•ì‹ ê²€ì¦
        const startDate = new Date(values['ì…í•™ë…„ë„']);
        const endDate = new Date(values['ì¡¸ì—…ë…„ë„']);

        if (startDate > endDate) {
          alert('ì¡¸ì—…ë…„ë„ëŠ” ì…í•™ë…„ë„ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }

        // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
        if (!values['í•™êµëª…'] || !values['ì…í•™ë…„ë„'] || !values['ì¡¸ì—…ë…„ë„'] || !values['ì „ê³µ'] || !values['í•™ì ']) {
          alert('í•™êµëª…, ì…í•™ë…„ë„, ì¡¸ì—…ë…„ë„ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }

        function searchSkills() {
          const input = document.getElementById("skillSearch").value.toLowerCase();
          const suggestionsBox = document.getElementById("skillSuggestions");
          suggestionsBox.innerHTML = "";

          if (!input) {
            suggestionsBox.style.display = "none";
            return;
          }

          const matches = availableSkills.filter(skill =>
            skill.toLowerCase().includes(input) && !selectedSkills.includes(skill)
          );

          if (matches.length === 0) {
            suggestionsBox.style.display = "none";
            return;
          }

          suggestionsBox.style.display = "block";
          matches.forEach(skill => {
            const div = document.createElement("div");
            div.textContent = skill;
            div.style.padding = "5px";
            div.style.cursor = "pointer";
            div.onclick = () => {
              selectedSkills.push(skill);
              document.getElementById("skillSearch").value = "";
              suggestionsBox.style.display = "none";
              searchSkills(); // ë‹¤ì‹œ ì‹¤í–‰í•´ì„œ ìƒˆ ëª©ë¡ ë°˜ì˜
            };
            suggestionsBox.appendChild(div);
          });
        }


        // ë³´ê¸° ì¹´ë“œ í˜•íƒœë¡œ ì¶œë ¥ë  HTML êµ¬ì„±
        summary.innerHTML = `
    <div class="education-card">
      <h4>${values['í•™êµëª…'] || ''} (${values['ì…í•™ë…„ë„'] || ''} ~ ${values['ì¡¸ì—…ë…„ë„'] || ''})</h4>
      <p><strong>ì „ê³µ:</strong> ${values['ì „ê³µ'] || ''}</p>
      <p><strong>í•™ì :</strong> ${values['í•™ì '] || ''}</p>
      <p><strong>ì¡¸ì—… êµ¬ë¶„:</strong> ${values['ì¡¸ì—…êµ¬ë¶„'] || ''}
              <button onclick="editEducation(this)" class="cencle_save_btn" style="float: right; margin-left: 8px;">ìˆ˜ì •</button>
              <button onclick="removeEducationForm(this)" class="cencle_save_btn" style="float: right;">ì‚­ì œ</button>
      </p>
    </div>
  `;


        // ì…ë ¥ ìš”ì†Œ ìˆ¨ê¸°ê¸°
        inputs.forEach(input => input.style.display = "none");

        // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        if (formButtons) {
          formButtons.style.display = "none";
        }

        // ìš”ì•½ ì¹´ë“œ ë³´ì´ê¸°
        summary.style.display = "block";
      }

      //ê²½ë ¥
      function showCareerForm() {

        const list = document.getElementById("career-list");

        // í˜„ì¬ ì—´ë ¤ ìˆëŠ” í¼ì´ ìˆëŠ”ì§€ í™•ì¸ (input/textareaê°€ ë³´ì´ëŠ” ìƒíƒœ)
        const isFormOpen = Array.from(list.querySelectorAll(".career-entry")).some(entry => {
          const inputs = entry.querySelectorAll("input, textarea");
          return Array.from(inputs).some(input => input.style.display !== "none");
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById("career-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = "block";
        list.appendChild(clone);
      }
      //ê²½ë ¥ ì‚­ì œ
      function removeCareerForm(button) {
        const entry = button.closest(".career-entry");
        if (entry) {
          entry.remove();
        }
      }
      //ê²½ë ¥ ì €ì¥
      function saveCareer(button) {
        const entry = button.closest(".career-entry");
        const summary = entry.querySelector(".career-summary");

        // inputê³¼ textarea ëª¨ë‘ ì„ íƒ
        const inputs = entry.querySelectorAll("input, textarea");
        const values = {};

        // ì…ë ¥ê°’ ìˆ˜ì§‘
        inputs.forEach(input => {
          values[input.placeholder] = input.value;
        });

        // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
        if (!values['íšŒì‚¬ëª…'] || !values['ì…ì‚¬ë…„ì›”'] || !values['í‡´ì‚¬ë…„ì›”'] || !values['ê·¼ë¬´ë¶€ì„œ'] || !values['ì§ë¬´'] || !values['ë‹´ë‹¹ì—…ë¬´']) {
          alert('íšŒì‚¬ëª…, ì…ì‚¬ë…„ì›”, í‡´ì‚¬ë…„ì›”, ê·¼ë¬´ë¶€ì„œ, ì§ë¬´, ë‹´ë‹¹ì—…ë¬´ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }

        // ë‚ ì§œ í˜•ì‹ ê²€ì¦
        const startDate = new Date(values['ì…ì‚¬ë…„ì›”']);
        const endDate = new Date(values['í‡´ì‚¬ë…„ì›”']);

        if (startDate > endDate) {
          alert('í‡´ì‚¬ë…„ì›”ëŠ” ì…ì‚¬ë…„ì›”ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }

        // HTML í…œí”Œë¦¿ ìƒì„±
        const careerCard = document.createElement('div');
        careerCard.className = 'career-card';
        careerCard.innerHTML = `
          <h4>${values['íšŒì‚¬ëª…'] || ''} (${values['ì…ì‚¬ë…„ì›”'] || ''} ~ ${values['í‡´ì‚¬ë…„ì›”'] || ''})</h4>
          <p><strong>ì§ë¬´:</strong> ${values['ì§ë¬´'] || ''}</p>
          <p><strong>ê·¼ë¬´ë¶€ì„œ:</strong> ${values['ê·¼ë¬´ë¶€ì„œ'] || ''}</p>
          <p><strong>ì§ê¸‰:</strong> ${values['ì§ê¸‰'] || ''}</p>
          <p><strong>ë‹´ë‹¹ì—…ë¬´:</strong> ${values['ë‹´ë‹¹ì—…ë¬´'] || ''}</p>
          <div class="card-buttons" style="display: flex; justify-content: flex-end; gap: 8px;">
            <button onclick="editCareer(this)" class="cencle_save_btn">ìˆ˜ì •</button>
            <button onclick="removeCareerForm(this)" class="cencle_save_btn">ì‚­ì œ</button>
          </div>
        `;

        // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê³  ìƒˆë¡œìš´ ì¹´ë“œ ì¶”ê°€
        summary.innerHTML = '';
        summary.appendChild(careerCard);

        // ì…ë ¥ ìš”ì†Œ ìˆ¨ê¸°ê¸°
        inputs.forEach(input => input.style.display = "none");

        // ì €ì¥/ì·¨ì†Œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        // ìš”ì•½ ì¹´ë“œ í‘œì‹œ
        summary.style.display = "block";

        // localStorageì— ì €ì¥
        const careerData = {
          company: values['íšŒì‚¬ëª…'],
          startDate: values['ì…ì‚¬ë…„ì›”'],
          endDate: values['í‡´ì‚¬ë…„ì›”'],
          position: values['ì§ë¬´'],
          department: values['ê·¼ë¬´ë¶€ì„œ'],
          rank: values['ì§ê¸‰'],
          duties: values['ë‹´ë‹¹ì—…ë¬´']
        };

        // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        let savedCareers = JSON.parse(localStorage.getItem('careers') || '[]');
        savedCareers.push(careerData);
        localStorage.setItem('careers', JSON.stringify(savedCareers));
      }
      //ê²½ë ¥ ìˆ˜ì •
      function editCareer(button) {
        const entry = button.closest(".career-entry");
        const summary = entry.querySelector(".career-summary");

        // inputê³¼ textarea ëª¨ë‘ ì„ íƒ
        const inputs = entry.querySelectorAll("input, textarea");

        // ìš”ì•½ ì¹´ë“œ ìˆ¨ê¹€
        summary.style.display = "none";

        // ëª¨ë“  ì…ë ¥ í•„ë“œ ë‹¤ì‹œ ë³´ì´ê¸°
        inputs.forEach(input => input.style.display = "inline-block");

        // ìš”ì•½ ì¹´ë“œ ë‚´ ë²„íŠ¼ ê·¸ë£¹ ì œê±°
        const cardButtons = summary.querySelector(".card-buttons");
        if (cardButtons) cardButtons.remove();

        // ì €ì¥/ì·¨ì†Œ ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê²Œ + ì •ë ¬ ìŠ¤íƒ€ì¼ ì ìš©
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }

      //ê²½í—˜/í™œë™/êµìœ¡
      function showExperienceForm() {

        const list = document.getElementById("experience-list");

        // í˜„ì¬ ì…ë ¥ ì¤‘ì¸ í¼ì´ ìˆëŠ”ì§€ í™•ì¸ //
        const isFormOpen = Array.from(list.querySelectorAll(".experience-entry")).some(entry => {
          const inputs = entry.querySelectorAll("input, textarea");
          return Array.from(inputs).some(input => input.style.display !== "none");
        });
        if (isFormOpen) {
          return;
        }
        const template = document.getElementById("experience-form-template").firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = "block";
        list.appendChild(clone);
      }

      //ê²½í—˜/í™œë™/êµìœ¡ ì‚­ì œ
      function removeExperienceForm(button) {
        const entry = button.closest(".experience-entry");
        if (entry) {
          entry.remove();
        }
      }
      //ê²½í—˜/í™œë™/êµìœ¡ ì €ì¥
      function saveExperience(button) {
        const entry = button.closest(".experience-entry");
        const summary = entry.querySelector(".experience-summary");
        const inputs = entry.querySelectorAll("input, textarea, select");
        const values = {};

        // ì…ë ¥ê°’ ê²€ì¦
        const startDate = new Date(entry.querySelector('input[placeholder="ì‹œì‘ë…„ì›”"]').value);
        const endDate = new Date(entry.querySelector('input[placeholder="ì¢…ë£Œë…„ì›”"]').value);

        if (startDate > endDate) {
          alert('ì¢…ë£Œë…„ì›”ì€ ì‹œì‘ë…„ì›”ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }

        // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
        const activityType = entry.querySelector('select').value;
        const place = entry.querySelector('input[placeholder="ê¸°ê´€/ì¥ì†Œëª…"]').value;
        const description = entry.querySelector('textarea').value;

        if (!activityType || !place || !description) {
          alert('í™œë™ ìœ í˜•, ê¸°ê´€/ì¥ì†Œëª…, í™œë™ ì„¤ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }

        // ê°’ ì €ì¥
        inputs.forEach(input => {
          if (input.tagName === 'SELECT') {
            values['í™œë™ ìœ í˜•'] = input.options[input.selectedIndex].text;
          } else {
            values[input.placeholder] = input.value.trim();
          }
        });

        // ë‚ ì§œ í¬ë§·íŒ…
        const formatDate = (dateStr) => {
          if (!dateStr) return '';
          const date = new Date(dateStr);
          return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}`;
        };

        // ê²½í—˜ ë°ì´í„° ì €ì¥
        const experienceData = {
          activityType: values['í™œë™ ìœ í˜•'],
          place: values['ê¸°ê´€/ì¥ì†Œëª…'],
          startDate: values['ì‹œì‘ë…„ì›”'],
          endDate: values['ì¢…ë£Œë…„ì›”'],
          description: values['í™œë™ ì„¤ëª…']
        };

        // localStorageì—ì„œ ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        let experiences = JSON.parse(localStorage.getItem('experiences') || '[]');
        experiences.push(experienceData);
        localStorage.setItem('experiences', JSON.stringify(experiences));

        summary.innerHTML = `
          <div class="experience-card">
            <h4>${values['í™œë™ ìœ í˜•'] || ''} - ${values['ê¸°ê´€/ì¥ì†Œëª…'] || ''} 
                (${formatDate(values['ì‹œì‘ë…„ì›”']) || ''} ~ ${formatDate(values['ì¢…ë£Œë…„ì›”']) || ''})</h4>
            <p><strong>í™œë™ ì„¤ëª…:</strong> ${values['í™œë™ ì„¤ëª…'] || ''}</p>
            <div class="card-buttons" style="display: flex; justify-content: flex-end; gap: 8px;">
              <button onclick="editExperience(this)" class="cencle_save_btn">ìˆ˜ì •</button>
              <button onclick="removeExperienceForm(this)" class="cencle_save_btn">ì‚­ì œ</button>
            </div>
          </div>
        `;

        // ì…ë ¥ í•„ë“œ ìˆ¨ê¸°ê¸°
        inputs.forEach(input => input.style.display = "none");

        // í¼ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        // ìš”ì•½ ì¹´ë“œ í‘œì‹œ
        summary.style.display = "block";
      }
      //ê²½í—˜/í™œë™/êµìœ¡ ìˆ˜ì •
      function editExperience(button) {
        const entry = button.closest(".experience-entry");
        const summary = entry.querySelector(".experience-summary");

        const inputs = entry.querySelectorAll("input, textarea, select");

        summary.style.display = "none";

        inputs.forEach(input => input.style.display = "inline-block");

        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }


      /* =========================================== ìê²©/ì–´í•™/ìˆ˜ìƒ */
      let certificateData = [];
      let certEditIndex = null;
      let editingCardEl = null;

      function showcertificate(isEdit = false) {
        const form = document.getElementById('certificate-form');
        form.style.display = 'block';

        /* ìƒˆ í•­ëª©ì¼ ë•Œ ì™„ì „ ì´ˆê¸°í™” */
        if (!isEdit) {
          certEditIndex = null;
          resetCertForm();   // ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        }

        showCertificateFields();   // íƒ€ì…ë³„ í•„ë“œ í† ê¸€
      }
      function cancelcertificate() {
        document.getElementById('certificate-form').style.display = 'none';

        /* â˜… ìˆ¨ê²¨ë‘” ì¹´ë“œê°€ ìˆìœ¼ë©´ ë‹¤ì‹œ ë³´ì´ê²Œ */
        if (editingCardEl) {
          editingCardEl.style.display = '';
          editingCardEl = null;
          certEditIndex = null;
        }
        resetCertForm();   // ë¹ˆ í¼ ìœ ì§€
      }
      function showCertificateFields() {
        const type = document.getElementById('certificateType').value;

        /* (A) ì•„ë¬´ ê²ƒë„ ì„ íƒí•˜ì§€ ì•Šì€ ìƒíƒœë©´ ì „ë¶€ ê°ì¶¤ */
        if (!type) {
          document.querySelectorAll('.cert-fields').forEach(el => el.style.display = 'none');
          return;
        }

        /* (B) ì„ íƒê°’ì´ ìˆì„ ë•Œë§Œ í•´ë‹¹ ë¸”ë¡ ë³´ì—¬ ì¤Œ */
        document.querySelectorAll('.cert-fields').forEach(el => {
          el.style.display = el.id.startsWith(type) ? 'block' : 'none';
        });
      }
      function savecertificate() {
        const type = document.getElementById('certificateType').value;
        if (!type) { alert('êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”'); return; }

        /* í™œì„± í•„ë“œì—ì„œ ê°’ ìˆ˜ì§‘ */
        const visible = document.querySelector(`#${type}Fields`);
        const obj = { type };
        visible.querySelectorAll('input, select').forEach(el => obj[el.name] = el.value.trim());

        /* ê°’ì´ í•˜ë‚˜ë¼ë„ ë¹„ì–´ ìˆìœ¼ë©´ ì €ì¥ ë§‰ê¸°(ì„ íƒ) */
        if (Object.values(obj).some(v => v === '')) { alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }

        /* ìƒˆ í•­ëª© vs ìˆ˜ì • í•­ëª© êµ¬ë¶„ */
        if (certEditIndex === null) {
          certificateData.push(obj);
        } else {
          certificateData[certEditIndex] = obj;
        }

        renderCertificateList();      // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ê·¸ë¦¼
        certEditIndex = null;
        editingCardEl = null;         // â˜… ë¦¬ì…‹
        resetCertForm();
        cancelcertificate();    // â† í¼ ìˆ¨ê¹€
      }
      function renderCertificateList() {
        const list = document.getElementById('certificate-list');
        list.innerHTML = '';

        certificateData.forEach((it, idx) => {
          /* â‘  ì¹´ë“œ div */
          const card = document.createElement('div');
          card.className = 'cert-card';

          /* â‘¡ ìƒì„¸ ë¬¸ìì—´ */
          let detail = '';
          if (it.type === 'license') {
            detail = `<strong>[ìê²©ì¦]</strong> ${it.license_name} Â· ${it.issuer} (${it.pass_date})`;
          } else if (it.type === 'language') {
            detail = `<strong>[ì–´í•™]</strong> ${it.lang} ${it.exam} ${it.score} (${it.status})`;
          } else {
            detail = `<strong>[ìˆ˜ìƒ]</strong> ${it.award_name} Â· ${it.host} (${it.award_date})`;
          }

          /* â‘¢ ë²„íŠ¼ ë¬¶ìŒ */
          const btnBox = `
      <div class="card-actions" style="display: flex; justify-content: flex-end; gap: 8px;">
        <button class="cencle_save_btn" onclick="editCertificate(${idx})">ìˆ˜ì •</button>
        <button class="cencle_save_btn" onclick="deleteCertificate(${idx})">ì‚­ì œ</button>
      </div>`;

          /* â‘£ ì¹´ë“œ ì™„ì„± & ì‚½ì… */
          card.innerHTML = `<span>${detail}</span>${btnBox}`;
          list.appendChild(card);
        });
      }
      function editCertificate(index) {
        certEditIndex = index;
        const it = certificateData[index];

        /* â‘  ì¹´ë“œ DOMì„ ì°¾ì•„ ìˆ¨ê¸°ê³  ë³€ìˆ˜ì— ë³´ê´€ */
        editingCardEl = document.querySelectorAll('.cert-card')[index];
        if (editingCardEl) editingCardEl.style.display = 'none';

        /* â‘¡ í¼ ì—´ê¸° & ê°’ ì£¼ì…(ê¸°ì¡´ ì½”ë“œ) */
        showcertificate(true);
        document.getElementById('certificateType').value = it.type;
        showCertificateFields();

        if (it.type === 'license') {
          ['license_name', 'issuer', 'pass_date'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        } else if (it.type === 'language') {
          ['lang', 'exam', 'score', 'status'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        } else {
          ['award_name', 'award_date', 'host'].forEach(n => document.querySelector(`[name="${n}"]`).value = it[n] || '');
        }
      }
      function deleteCertificate(index) {
        if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { certificateData.splice(index, 1); renderCertificateList(); }
      }
      function resetCertForm() {
        const form = document.getElementById('certificate-form');

        /* ë“œë¡­ë‹¤ìš´ ì²« ë²ˆì§¸ ê°’ */
        document.getElementById('certificateType').selectedIndex = 0;

        /* ëª¨ë“  input ê°’ ì œê±° */
        form.querySelectorAll('input').forEach(el => el.value = '');

        /* ë‚˜ë¨¸ì§€ select ë„ ì²« ë²ˆì§¸ ê°’ìœ¼ë¡œ */
        form.querySelectorAll('select').forEach(el => {
          if (el !== document.getElementById('certificateType')) el.selectedIndex = 0;
        });

        /* ì„¸ë¶€ í•„ë“œ ì „ë¶€ ìˆ¨ê¹€ */
        document.querySelectorAll('.cert-fields').forEach(el => el.style.display = 'none');
      }

      /* ======================================= ì·¨ì—…ìš°ëŒ€ì‚¬í•­ */
      let preferenceData = [];
      let prefEditIndex  = null;
      let prefCardHidden = null;

      /* â‘  í¼ ì—´ê¸° */
      function showPreference(isEdit=false){
        const form = document.getElementById('preference-form');
        form.style.display='block';

        if(!isEdit){
          prefEditIndex = null;           
          prefCardHidden = null;
          resetPrefForm();
        }
        showPreferenceFields();
      }

      /* â‘¡ í¼ ë‹«ê¸° */
      function cancelPreference(){
        document.getElementById('preference-form').style.display='none';
        if(prefCardHidden){ prefCardHidden.style.display=''; prefCardHidden=null; }
        prefEditIndex=null;
        resetPrefForm();
      }

      /* â‘¢ ë“œë¡­ë‹¤ìš´ì— ë§ì¶° ë¶€ë¶„ í•„ë“œ í† ê¸€ */
      function showPreferenceFields(){
        const type = document.getElementById('preferenceType').value;
        if(!type){
          document.querySelectorAll('.pref-fields').forEach(el=>el.style.display='none');
          return;
        }
        document.querySelectorAll('.pref-fields').forEach(el=>{
          el.style.display = el.id.startsWith(type)?'block':'none';
        });
      }

      /* â‘£ ì €ì¥ */
      function savePreference() {
        const type = document.getElementById('preferenceType').value;
        if (!type) {
          alert('êµ¬ë¶„ ì„ íƒ');
          return;
        }

        const obj = { type };

        if (type === 'veteran') {
          obj.v_type = document.querySelector('[name="v_type"]').value.trim();
          obj.v_cert = document.querySelector('[name="v_cert"]').value.trim();

          if (!obj.v_type || !obj.v_cert) {
            alert('ëª¨ë“  í•­ëª© ì…ë ¥');
            return;
          }

        } else if (type === 'military') {
          obj.m_status = document.querySelector('[name="m_status"]').value.trim();

          if (!obj.m_status) {
            alert('ë³‘ì—­ êµ¬ë¶„ ì…ë ¥');
            return;
          }

          // êµ°í•„ì¼ ê²½ìš°ì—ë§Œ ì¶”ê°€ í•„ë“œ ì…ë ¥ ë°›ê¸°
          if (obj.m_status === 'served') {
            obj.m_start = document.querySelector('[name="m_start"]').value.trim();
            obj.m_end = document.querySelector('[name="m_end"]').value.trim();
            obj.m_branch = document.querySelector('[name="m_branch"]').value.trim();
            obj.m_rank = document.querySelector('[name="m_rank"]').value.trim();
            obj.m_reason = document.querySelector('[name="m_reason"]').value.trim();

            if (!obj.m_start || !obj.m_end || !obj.m_branch || !obj.m_rank || !obj.m_reason) {
              alert('êµ°í•„ í•­ëª© ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”');
              return;
            }
          }

        } else if (type === 'employment') {
          obj.e_type = document.querySelector('[name="e_type"]').value.trim();
          if (!obj.e_type) {
            alert('ì§€ì›ê¸ˆ ì¢…ë¥˜ ì…ë ¥');
            return;
          }
        }

        if (prefEditIndex === null) {
          preferenceData.push(obj);
        } else {
          preferenceData[prefEditIndex] = obj;
        }

        renderPreferenceList();
        prefEditIndex = null;
        prefCardHidden = null;
        resetPrefForm();
        cancelPreference();
      }


      /* â‘¤ ì¹´ë“œ ë Œë” */
      function renderPreferenceList(){
        const list=document.getElementById('preference-list');
        list.innerHTML='';

        preferenceData.forEach((it,idx)=>{
          let detail='';
          if(it.type==='veteran')    detail=`[ë³´í›ˆ] ${it.v_type} (ì¦ì„œ: ${it.v_cert})`;
          else if(it.type==='military'){
          if(it.m_status==='served'){
            detail = `[êµ°í•„] ${it.m_branch}Â·${it.m_rank} (${it.m_start}~${it.m_end}) / ${it.m_reason}`;
          }else{
            detail = `[ë³‘ì—­] ${it.m_status}`;   // ë©´ì œÂ·ë¯¸í•„
          }
        }
          else detail=`[ì§€ì›ê¸ˆ] ${it.e_type}`;

          const card=document.createElement('div');
          card.className='pref-card';
          card.innerHTML=`
            <span>${detail}</span>
            <div class="card-actions">
              <button class="cencle_save_btn" onclick="editPreference(${idx})">ìˆ˜ì •</button>
              <button class="cencle_save_btn" onclick="deletePreference(${idx})">ì‚­ì œ</button>
            </div>`;
          list.appendChild(card);
        });
      }

      /* â‘¥ ìˆ˜ì • */
      function editPreference(idx){
        prefEditIndex = idx;
        prefCardHidden = document.querySelectorAll('.pref-card')[idx];
        if(prefCardHidden) prefCardHidden.style.display='none';

        const it = preferenceData[idx];
        showPreference(true);

        document.getElementById('preferenceType').value=it.type;
        showPreferenceFields();

        if(it.type==='veteran'){
          document.querySelector('[name="v_type"]').value = it.v_type;
          document.querySelector('[name="v_cert"]').value = it.v_cert;
        }else if(it.type==='military'){
          document.querySelector('[name="m_status"]').value = it.m_status;
        }else{
          document.querySelector('[name="e_type"]').value = it.e_type;
        }
      }   

      /* â‘¦ ì‚­ì œ */
      function deletePreference(idx){
        if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
          preferenceData.splice(idx,1);
          renderPreferenceList();
        }
      }

      /* â‘§ í¼ ë¦¬ì…‹ */
      function resetPrefForm(){
        const form=document.getElementById('preference-form');
        document.getElementById('preferenceType').selectedIndex=0;
        form.querySelectorAll('input').forEach(el=>el.value='');
        form.querySelectorAll('select').forEach(el=>{
          if(el!==document.getElementById('preferenceType')) el.selectedIndex=0;
        });
        document.querySelectorAll('.pref-fields').forEach(el=>el.style.display='none');
      }

      /* ë³‘ì—­ êµ¬ë¶„ ì„ íƒ â†’ êµ°í•„ ìƒì„¸ ì…ë ¥ ë…¸ì¶œ */
      function toggleMilitaryDetail(){
        const val = document.getElementById('mStatus').value;
        document.getElementById('servedDetail').style.display = (val === 'served') ? 'inline-block' : 'none';
      }

      //í¬íŠ¸í´ë¦¬ì˜¤
      function showPortfolioForm() {
        const list = document.getElementById('portfolio-list');

        // í¼ì´ ì‹¤ì œë¡œ ì—´ë ¤ ìˆëŠ”ì§€ í™•ì¸: ì…ë ¥ë€ì´ ë³´ì´ëŠ” entryë§Œ
        const isFormOpen = Array.from(list.querySelectorAll('.portfolio-entry')).some(entry => {
          const inputs = entry.querySelectorAll('input, textarea');
          return Array.from(inputs).some(input => input.style.display !== 'none');
        });

        if (isFormOpen) {
          return;
        }

        const template = document.getElementById('portfolio-form-template').firstElementChild;
        const clone = template.cloneNode(true);
        clone.style.display = 'block';
        list.appendChild(clone);
      }
      //í¬í´ ì‚­ì œ
      function removePortfolioForm(button) {
        const entry = button.closest(".portfolio-entry");
        if (entry) {
          entry.remove();
        }
      }
      //í¬í´ ì €ì¥
      function savePortfolio(button) {
        const entry = button.closest(".portfolio-entry");
        const summary = entry.querySelector(".portfolio-summary");

        const inputs = entry.querySelectorAll("input, textarea");
        const fileInput = entry.querySelector(".file-input");

        const values = {};
        inputs.forEach(input => {
          if (input.type !== "file") {
            values[input.placeholder] = input.value;
          }
        });

        // íŒŒì¼ ì´ë¦„ ëª©ë¡ ìƒì„±
        const fileNames = [];
        for (let i = 0; i < fileInput.files.length; i++) {
          fileNames.push(fileInput.files[i].name);
        }

        summary.innerHTML = `
    <div class="portfolio-card">
      <h4>${values['í”„ë¡œì íŠ¸ëª…'] || ''}</h4>
      <p><strong>ì„¤ëª…:</strong> ${values['í”„ë¡œì íŠ¸ ì„¤ëª…'] || ''}</p>
      ${fileNames.length > 0 ? `<p><strong>ì²¨ë¶€íŒŒì¼:</strong> ${fileNames.join(', ')}</p>` : ''}
      <div style="display: flex; justify-content: flex-end; gap: 8px;">
        <button onclick="editPortfolio(this)" class="cencle_save_btn">ìˆ˜ì •</button>
        <button onclick="removePortfolioForm(this)" class="cencle_save_btn">ì‚­ì œ</button>
      </div>
    </div>
  `;

        if (!values['í”„ë¡œì íŠ¸ëª…'] || !values['í”„ë¡œì íŠ¸ ì„¤ëª…']) {
          alert('í”„ë¡œì íŠ¸ëª…, í”„ë¡œì íŠ¸ ì„¤ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
          return;
        }

        inputs.forEach(input => input.style.display = "none");
        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) formButtons.style.display = "none";

        summary.style.display = "block";
      }
      //í¬í´ ìˆ˜ì •
      function editPortfolio(button) {
        const entry = button.closest(".portfolio-entry");
        const summary = entry.querySelector(".portfolio-summary");

        const inputs = entry.querySelectorAll("input, textarea");
        summary.style.display = "none";

        inputs.forEach(input => input.style.display = "inline-block");

        const formButtons = entry.querySelector(".form-buttons");
        if (formButtons) {
          formButtons.style.display = "flex";
          formButtons.style.justifyContent = "flex-end";
          formButtons.style.gap = "8px";
        }
      }


      //ê²½ë ¥ê¸°ìˆ ì„œ
      function showdescription() {
        document.getElementById('career-description-form').style.display = 'block';
      }
      function canceldescription() {
        document.getElementById('career-description-form').style.display = 'none';
        document.getElementById("careerDescriptionText").value = "";
        updateCharCount();
      }
      function updateCharCount() {
        const textArea = document.getElementById("careerDescriptionText");
        if (!textArea) return;  // í…ìŠ¤íŠ¸ ì˜ì—­ì´ ì•„ì§ ì—†ìœ¼ë©´ ê·¸ëƒ¥ í•¨ìˆ˜ ì¢…ë£Œ

        const text = textArea.value;
        const total = text.length;
        const noSpace = text.replace(/\s/g, "").length;
        const byteSize = new Blob([text]).size;
        const byteNoSpace = new Blob([text.replace(/\s/g, "")]).size;

        const totalChars = document.getElementById("totalChars");
        const totalBytes = document.getElementById("totalBytes");
        const noSpaceChars = document.getElementById("noSpaceChars");
        const noSpaceBytes = document.getElementById("noSpaceBytes");

        if (totalChars) totalChars.innerText = total;
        if (totalBytes) totalBytes.innerText = byteSize;
        if (noSpaceChars) noSpaceChars.innerText = noSpace;
        if (noSpaceBytes) noSpaceBytes.innerText = byteNoSpace;
      }


      function savedescription() {
        const text = document.getElementById("careerDescriptionText").value;
        if (!text.trim()) {
          alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        const summaryContainer = document.createElement("div");
        summaryContainer.className = "career-desc-card";
        summaryContainer.innerHTML = `
          <div style="white-space: pre-wrap;">${text}</div>
          <div style="margin-top: 10px; text-align: right;">
            <button onclick="editDescription(this)" class="cencle_save_btn">ìˆ˜ì •</button>
            <button onclick="removeDescription(this)" class="cencle_save_btn">ì‚­ì œ</button>
          </div>
        `;

        document.getElementById("career-description-list").appendChild(summaryContainer);
        document.getElementById("careerDescriptionText").value = "";
        document.getElementById("career-description-form").style.display = "none";
        updateCharCount();
      }



      function editDescription(button) {
        const card = button.closest(".career-desc-card");
        if (!card) return;

        const content = card.querySelector("div").innerText;
        document.getElementById("careerDescriptionText").value = content;
        document.getElementById("career-description-form").style.display = "block";

        card.remove();
        updateCharCount();
      }

      function removeDescription(button) {
        const card = button.closest(".career-desc-card");
        if (!card) return;
        card.remove();
      }
      const text = document.getElementById("careerDescriptionText").value;

      function insertTemplate(type) {
        const textarea = document.getElementById("careerDescriptionText");
        let content = "";

        switch (type) {
          case "project":
            content =
              `1) í”„ë¡œì íŠ¸ëª…:

    - ì—°ê³„/ì†Œì†íšŒì‚¬ : (ì—°ê³„/ì†Œì†íšŒì‚¬ê°€ ì—†ì„ ê²½ìš°, í•´ë‹¹ í•­ëª©ì„ ì§€ìš°ê³  ì‘ì„±í•˜ì„¸ìš”)
    - ìˆ˜í–‰ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (ì•½ Nê°œì›”)
    - ì£¼ìš” ì—­í•  : í™”ë©´ ì„¤ê³„ ë° ì„œë¹„ìŠ¤ ê¸°íš
    - ì—…ë¬´ ì„±ê³¼ :`;
            break;

          case "dev":
            content =
              `1) í”„ë¡œì íŠ¸ëª…:

    - ì—°ê³„/ì†Œì†íšŒì‚¬ : (ì—°ê³„/ì†Œì†íšŒì‚¬ê°€ ì—†ì„ ê²½ìš°, í•´ë‹¹ í•­ëª©ì„ ì§€ìš°ê³  ì‘ì„±í•˜ì„¸ìš”)
    - ì£¼ìš” ì—…ë¬´ : ë°±ì—”ë“œ ë‹´ë‹¹
    - ë‹´ë‹¹ ì—­í•  :
    - ê¸°ìˆ  ìŠ¤íƒ : (ìš´ì˜ì²´ì œ, ê°œë°œì–¸ì–´, ë°ì´í„°ë² ì´ìŠ¤ ë“±)
    - ì—…ë¬´ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (ì•½ Nê°œì›”)
    - ê°œë°œ ì¸ì› :
    - ìƒì„¸ ë‚´ìš© :`;
            break;

          case "design":
            content =
              `1) ì£¼ìš” ì—…ë¬´ : ì½˜í…ì¸  ì œì‘

    - ì‚¬ìš© Tool : ex) photoshop
    - ì—…ë¬´ê¸°ê°„ : YYYY.MM ~ YYYY.MM (ì•½ Nê°œì›”)
    - í¬íŠ¸í´ë¦¬ì˜¤ URL :
    - ìƒì„¸ë‚´ìš© :`;
            break;

          case "sales":
            content =
              `1) í”„ë¡œì íŠ¸ëª…:

    - ì—°ê³„/ì†Œì†íšŒì‚¬ : (ì—°ê³„/ì†Œì†íšŒì‚¬ê°€ ì—†ì„ ê²½ìš°, í•´ë‹¹ í•­ëª©ì„ ì§€ìš°ê³  ì‘ì„±í•˜ì„¸ìš”)
    - ì£¼ìš” ì—…ë¬´ :
    - ìˆ˜í–‰ ê¸°ê°„ : YYYY.MM ~ YYYY.MM (ì•½ Nê°œì›”)
    - ë‹´ë‹¹ ì§€ì—­ :
    - ê³„ì•½ ê±´ìˆ˜ : ì›” í‰ê·  _ê±´
    - ê³ ê° ìˆ˜ : ex. ì¸ìˆ˜ 30%, ì‹ ê·œê°œì²™ 70%
    - ìƒì„¸ ë‚´ìš© :`;
            break;
        }

        textarea.value = content;
        updateCharCount();
      }

      
      //ìê¸°ì†Œê°œì„œ

      function collectIntroductionData() {
        const cards = document.querySelectorAll('.intro-card');
        return Array.from(cards).map(card => ({
          title: card.querySelector('h4').innerText,
          content: card.querySelector('.intro-content').innerText
        }));
      }

      
      function showintroduction() {
        document.getElementById('introduction-form').style.display = 'block';

      }
      function updateIntroCount() {
        const text = document.getElementById("introTextarea").value;
        const chars = text.length;
        const bytes = new Blob([text]).size;
        document.getElementById("introChars").innerText = chars;
        document.getElementById("introBytes").innerText = bytes;
      }
      

      async function postJSON(url, payload){
        const resp = await fetch(url, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error(await resp.text());
        return resp.json();
      }

      // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
      function showLoading(text) {
        document.getElementById('loadingText').textContent = text;
        document.getElementById('loadingOverlay').style.display = 'flex';
      }
      
      function hideLoading() {
        document.getElementById('loadingOverlay').style.display = 'none';
      }

      /* ë§ì¶¤ë²• */
      async function checkSpelling(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”"); return; }

        showLoading("ë§ì¶¤ë²• ê²€ì‚¬ ì¤‘...");
        try{
          const data = await postJSON("/api/spellcheck/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("ë§ì¶¤ë²• êµì • ì™„ë£Œ!");
        }catch(e){
          console.error(e); alert("êµì • ì‹¤íŒ¨");
        }finally{
          hideLoading();
        }
      }

      /* AI ì²¨ì‚­ */
      async function runAIReview(){
        const text = document.getElementById("introTextarea").value.trim();
        if(!text){ alert("ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”"); return; }

        showLoading("AI ì²¨ì‚­ ì¤‘...");
        try{
          const data = await postJSON("/api/proofread/", { text });
          document.getElementById("introTextarea").value = data.result;
          updateIntroCount();
          alert("AI ì²¨ì‚­ ì™„ë£Œ!");
        }catch(e){
          console.error(e); alert("ì²¨ì‚­ ì‹¤íŒ¨");
        }finally{
          hideLoading();
        }
      }

      window.onload = () => {
        const resumes = JSON.parse(localStorage.getItem('resumeList')) || [];
        resumes.forEach(resume => addToResumeList(resume.basicInfo.title));
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ì •ë³´ ìë™ ì±„ìš°ê¸°
        if (defaultInfo && Object.keys(defaultInfo).length > 0) {
          document.getElementById('name').value = defaultInfo.name || '';
          document.getElementById('gender').value = defaultInfo.gender || '';
          document.getElementById('birthdate').value = defaultInfo.birthdate || '';
          document.getElementById('email').value = defaultInfo.email || '';
          document.getElementById('phone').value = defaultInfo.phone || '';
          document.getElementById('address').value = defaultInfo.address || '';
          document.getElementById('detail-address').value = defaultInfo.detail_address || '';
        }
      };


      function resetResumeForm() {
        // ì„ íƒëœ ì´ë ¥ì„œ ID ì´ˆê¸°í™”
        selectedResumeId = null;
        
        // 1. ì œëª©ì€ ë¹„ìš°ê³ , ê¸°ë³¸ì •ë³´ëŠ” ì €ì¥ëœ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°
        document.getElementById('resume-title').value = '';
        document.getElementById('name').value = defaultInfo.name || '';
        document.getElementById('gender').value = defaultInfo.gender || '';
        document.getElementById('birthdate').value = defaultInfo.birthdate || '';
        document.getElementById('email').value = defaultInfo.email || '';
        document.getElementById('phone').value = defaultInfo.phone || '';
        document.getElementById('address').value = defaultInfo.address || '';
        document.getElementById('detail-address').value = defaultInfo.detail_address || '';

        // 2. ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ + í¼ ëª¨ë‘ ë‹«ê¸°
        const sectionNames = [
          'education', 'career', 'skill', 'experience', 'certificate',
          'preference', 'portfolio', 'career-description', 'introduction'
        ];
        sectionNames.forEach(key => {
          const cb = document.getElementById(`section-${key}`);
          const section = document.getElementById(`${key}-section`);
          if (cb) cb.checked = false;
          if (section) section.style.display = 'none';
        });

        // 3. ê° í•­ëª© ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°
        // í•™ë ¥/ê²½ë ¥/ìŠ¤í‚¬ ë“± ë¦¬ìŠ¤íŠ¸ ë¶€ë¶„ ì´ˆê¸°í™”
        const sectionListIds = [
          'education-list', 'career-list', 'skill-list', 'experience-list',
          'certificate-list', 'preference-list', 'portfolio-list',
          'career-description-list', 'introduction-list'
        ];
        sectionListIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.innerHTML = '';
        });

        // 4. ìŠ¤í‚¬ íƒœê·¸ ì´ˆê¸°í™”
        selectedSkills = [];
        updateSkillList();

        // 5. ê¸°íƒ€(í¬íŠ¸í´ë¦¬ì˜¤, ê²½ë ¥ê¸°ìˆ ì„œ ë“± ì„ì‹œ ì…ë ¥í¼ë„ ë‹«ê¸°)
        const formIds = [
          'education-form-template', 'career-form-template', 'skill-form',
          'experience-form-template', 'certificate-form', 'preference-form',
          'portfolio-form-template', 'career-description-form', 'introduction-form'
        ];
        formIds.forEach(fid => {
          const f = document.getElementById(fid);
          if (f) f.style.display = 'none';
        });

        // 6. sectionData ë“± ë°ì´í„° ë°°ì—´ë“¤ë„ ë¹„ìš¸ ê²ƒ ìˆìœ¼ë©´ ì—¬ê¸°ì„œ ë¹„ìš°ê¸°
        // ì˜ˆ: certificateData = [], preferenceData = []

        if (typeof certificateData !== 'undefined') certificateData = [];
        if (typeof preferenceData !== 'undefined') preferenceData = [];

        // 7. ì´ë¯¸ì§€ ì´ˆê¸°í™”
        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì´ˆê¸°í™”
        const previewDiv = document.getElementById("profile-image-preview");
        const fileInput = document.getElementById("profile-image-input");
        const uploadPlus = document.getElementById("upload-plus");

        if (previewDiv) {
          previewDiv.style.backgroundImage = '';
        }
        if (uploadPlus) {
          uploadPlus.style.display = 'inline';
        }
        if (fileInput) {
          fileInput.value = '';  // input[type=file] ì´ˆê¸°í™”
}


      
      }

      //ìê¸°ì†Œê°œì„œ
      function showIntroductionForm() {
        document.getElementById("introduction-form").style.display = "block";
      }

      function cancelIntroductionForm() {
        document.getElementById("introduction-form").style.display = "none";
        document.getElementById("introTitle").value = "";
        document.getElementById("introTextarea").value = "";
        updateIntroCount();
      }

      function saveIntroductionForm() {
        const title = document.getElementById("introTitle").value.trim();
        const content = document.getElementById("introTextarea").value.trim();
        if (!title || !content) {
          alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        const contentHTML = content.replace(/\n/g, "<br>");

        const card = document.createElement("div");
        card.className = "intro-card";
        card.style.padding = "10px";
        card.style.marginTop = "10px";
        card.style.display = "block";  
        card.innerHTML = `
          <h4 style="margin-bottom: 10px;">${title}</h4>
          <div class="intro-content" style="white-space: pre-wrap; margin-bottom: 20px;">${contentHTML}</div>
          <div style="text-align: right; margin-top: 10px;">
            <button onclick="editIntroduction(this)" class="cencle_save_btn">ìˆ˜ì •</button>
            <button onclick="removeIntroduction(this)" class="cencle_save_btn">ì‚­ì œ</button>
          </div>
        `;
        document.getElementById("introduction-list").appendChild(card);
        cancelIntroductionForm();
      }
      function editIntroduction(button) {
        const card = button.closest(".intro-card");
        const title = card.querySelector("h4").innerText;
        const content = card.querySelector(".intro-content").innerText; 
        document.getElementById("introTitle").value = title;
        document.getElementById("introTextarea").value = content;
        document.getElementById("introduction-form").style.display = "block";
        card.remove();
        updateIntroCount();
      }
      function removeIntroduction(button) {
        const card = button.closest(".intro-card");
        if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          card.remove();
        }
      }
      function updateIntroCount() {
        const text = document.getElementById("introTextarea").value;
        const chars = text.length;
        const bytes = new Blob([text]).size;
        document.getElementById("introChars").innerText = chars;
        document.getElementById("introBytes").innerText = bytes;
      }
      

      async function postJSON(url, payload){
        const resp = await fetch(url, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error(await resp.text());
        return resp.json();
      }

      // ì´ë¯¸ì§€ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸°ë¡œ í‘œì‹œ
      function previewProfileImage(event) {
        const input = event.target;
        const previewDiv = document.getElementById("profile-image-preview");

        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewDiv.style.backgroundImage = `url('${e.target.result}')`;
            document.getElementById("upload-plus").style.display = 'none';  // + ë²„íŠ¼ ìˆ¨ê¹€
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      // div í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ input ì—´ê¸°
      document.getElementById("profile-image-preview").addEventListener("click", function() {
        document.getElementById("profile-image-input").click();
      });





      function previewResume() {
        if (selectedResumeId) {
          // ì´ë¯¸ ì €ì¥ëœ ì´ë ¥ì„œë¥¼ ì„ íƒí•œ ìƒíƒœì¸ ê²½ìš° â†’ GET ìš”ì²­ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°
          window.open(`/resume/preview/${selectedResumeId}/`, '_blank');
          return;
        }
        const title = document.getElementById('resume-title').value;
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const birthdate = document.getElementById('birthdate').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const detailAddress = document.getElementById('detail-address').value;

        const sectionCheckboxStates = getSectionCheckboxStates();
        const sections = {
          education: collectEducationData() || [],
          career: collectCareerData() || [],
          experience: collectExperienceData() || [],
          certificate: collectCertificateData() || [],
          preference: collectPreferenceData() || [],
          portfolio: collectPortfolioData() || [],
          description: collectCareerDescriptionData() || [],
          introduction: collectIntroductionData() || [],
          skills: selectedSkills || [],
          sectionCheckboxStates: sectionCheckboxStates
        };

        const formData = new URLSearchParams();
        formData.append("title", title);
        formData.append("name", name);
        formData.append("gender", gender);
        formData.append("birthdate", birthdate);
        formData.append("email", email);
        formData.append("phone", phone);
        formData.append("address", address);
        formData.append("detail-address", detailAddress);
        formData.append("sections_json", JSON.stringify(sections));

        fetch('/save_resume/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken'),
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.resume_id) {
            window.open(`/resume/preview/${data.resume_id}/`, '_blank');
          } else {
            alert("ì´ë ¥ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        })
        .catch(err => {
          alert("ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨: " + err);
        });
      }



    </script>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 30px 50px; border-radius: 16px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
    <div style="width: 50px; height: 50px; border: 4px solid #f5d1ea; border-top: 4px solid #ff69b4; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
    <p id="loadingText" style="font-size: 16px; font-weight: 600; color: #ff69b4; margin: 0;">ì²˜ë¦¬ ì¤‘...</p>
  </div>
</div>
<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</body>

</html>